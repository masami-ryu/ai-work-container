# プランレビュー: PRレビューエージェント精度向上プラン（第2版）

**レビュー日**: 2025-12-02  
**対象プラン**: `ai/plans/251202_PRレビューエージェント精度向上プラン.md`  
**レビュアー**: GitHub Copilot (PlanCreatorモード)

---

## 📊 総合評価

| 評価項目 | スコア | コメント |
|---------|--------|---------|
| **全体構成** | ⭐⭐⭐⭐⭐ | フェーズ/ステージ構成が明快で依存関係も明示済み |
| **実現可能性** | ⭐⭐⭐⭐☆ | MCP活用ステップは現状ツールセットで実装可能だが、計測と権限管理の手当が未記載 |
| **完了条件の明確性** | ⭐⭐⭐☆☆ | Phase 4 などで測定指標が一部主観評価のまま |
| **リスク管理** | ⭐⭐⭐⭐☆ | リスクとフォールバックはあるが、検証データの収集方法が未整理 |
| **実装詳細度** | ⭐⭐⭐⭐⭐ | MCP呼び出し順序や出力フォーマット例が充実 |

**総合スコア**: ⭐⭐⭐⭐☆ (4.3/5.0)

---

## ✅ 優れている点
- **段階的ロールアウト**: ステージ1→3の漸進導入で障害切り分けが容易。
- **MCP活用ガイド**: `get_symbols_overview`/`find_referencing_symbols`/`msdocs`/`context7`の呼び出し例が実務レベルで記述済み。
- **フォールバック指針**: 各Phase毎に失敗時の代替手段があり、停止しにくい設計。
- **成果物定義**: `pull-request-reviewer.agent.md`更新内容が粒度高く整理されている。

---

## ⚠️ 改善が必要な点

### 🔴 高優先度

1. **成果指標の計測方法が未定義**  
   - 成功基準・品質メトリクスに具体的なログ/計測ポイントがなく、改善効果を客観評価できません。  
   - 例: 「エビデンス付き指摘80%」を検証するための計測ロジック（レビュー結果の自動集計、タグ付けなど）が Phase 4・Stage 2 いずれにも記載されていません。  
   - **提案**: Phase 4に「レビュー出力を構造化フォーマット(JSON/Markdown)で保存し、`ai/reviews`を週次スキャンして指標を算出する」タスクを追加してください。Microsoft Learnの[Get feedback with pull requests](https://learn.microsoft.com/en-us/devops/develop/git/git-pull-requests)でも「高品質レビューには明確で測定可能なフィードバックが必須」と明示されています。  

2. **PRコンテキスト取得の責務が曖昧**  
   - msdocs「[Improve pull request descriptions using templates](https://learn.microsoft.com/en-us/azure/devops/repos/git/pull-request-templates?view=azure-devops)」では、テンプレートを使ってレビュアーに必要情報を渡すことを推奨していますが、プランではPRテンプレート/ガイドの整備タスクがありません。  
   - **提案**: Phase 1に「PRテンプレートの必須項目（変更概要、テスト結果、検証環境、想定レビュー観点）を定義し、エージェントがそれを前提に動作する」ステップを追加し、テンプレートが未充足の場合のフォールバックを記述してください。  

### 🟠 中優先度

3. **Phase 4テーブルの構造エラー**  
   - `Phase 4`の表見出し行が4列（最後の空列）になっており、テンプレートと整合しません。Plan実装時の手戻りになるので修正を推奨します。  

4. **レビュアー選定ロジックの強化余地**  
   - 計画では`CODEOWNERS`に依存していますが、Microsoft Learnの[Get feedback with pull requests](https://learn.microsoft.com/en-us/devops/develop/git/git-pull-requests)は「ドメイン外レビューを含めて知見を拡散する」ことを推奨しています。  
   - **提案**: Phase 3に、`CODEOWNERS`以外の観点（最近のコミット履歴、専門タグなど）で第二レビュアーを推薦する手順を追加してください。  

5. **検証データの保存先不明確**  
   - Stage 1成功条件に「エラー率5%以下」等があるものの、エラーログの保存先や収集方法が未記載です。  
   - **提案**: Phase 4.4（品質検証）に「レビュー実行ログを`docs/review-metrics/`へ保存し、スクリプトで集計」などのタスクを追加すると、計測ギャップを埋められます。  

### 🟢 低優先度

6. **Quick Reviewとの切り分けを数値化**  
   - Quick/Standard/Deepの判定条件が「小規模PR」など定性的。変更ファイル数や差分行数の閾値を明示すると実装が容易になります。  

7. **セキュリティ観点の明示**  
   - プラン全体は品質/設計中心で、セキュリティ検証（秘密情報の混入、依存ライセンス等）の観点が見当たりません。必要ならPhase 4に「セキュリティチェックリストへのリンク」を追記してください。  

---

## 🎯 判定
- **結論**: ✅ *完全承認*（v2指摘事項をすべて反映済み）
- **反映済み修正**: 
  1. ✅ 成果指標の計測プロセス（Phase 4.5、計測データフォーマット節、週次集計スクリプト）
  2. ✅ PRテンプレート連携（Phase 1.0、フォールバック戦略）
  3. ✅ Phase 4テーブル構造修正（4列→3列）
  4. ✅ CODEOWNERS外レビュアー推薦（Phase 3.3）
  5. ✅ 検証データ保存先（`ai/review-metrics/`）
  6. ✅ Quick/Standard/Deepの閾値明示（PR規模判定基準表）

---

## 🔄 推奨アクション
~~1. Phase 1に「PRテンプレート整備＋入力検証」タスクを追加し、未入力時のフォールバックを定義する。~~  ✅ 完了
~~2. Phase 4・Stage 2の完了条件へ「レビュー出力を機械可読形式で保存し、週次バッチで指標（具体性/エビデンス比率等）を計測する」ステップを追記する。~~  ✅ 完了
~~3. 検証ログ保存ディレクトリと収集スクリプト例（疑似コードで可）を`成果物`節に追加する。~~  ✅ 完了
~~4. CODEOWNERS外レビュアーを推薦するための選定ヒューリスティクスをPhase 3に組み込む。~~  ✅ 完了
~~5. 表組み・閾値・観点リストなどのドキュメント体裁をテンプレートに合わせて再チェックする。~~  ✅ 完了

---

**次のステップ**: 実装エージェント（agent モード）へのハンドオフ可能。