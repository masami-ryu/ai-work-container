# Claude API - Tool Search Tool å°å…¥ãƒ—ãƒ©ãƒ³

ä½œæˆæ—¥: 2025å¹´12æœˆ08æ—¥
ä½œæˆè€…: Claude Guide Agent
ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹: Draft

## 1. æ¦‚è¦

### ç›®çš„
Claude API ã® Tool Search Tool(ãƒ™ãƒ¼ã‚¿æ©Ÿèƒ½)ã‚’ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã«å°å…¥ã—ã€Claude Agent SDK ã‚’ä½¿ç”¨ã—ãŸå¤§è¦æ¨¡ãƒ„ãƒ¼ãƒ«ç’°å¢ƒã§ã®åŠ¹ç‡çš„ãªãƒ„ãƒ¼ãƒ«é¸æŠã‚’å®Ÿç¾ã™ã‚‹ã€‚

### ã‚¹ã‚³ãƒ¼ãƒ—
- å¯¾è±¡: Claude API çµ±åˆã€Agent SDK ã§ã®ãƒ„ãƒ¼ãƒ«æ¤œç´¢å®Ÿè£…
- å¯¾è±¡å¤–: æ—¢å­˜ã® Claude Code CLI ãƒ„ãƒ¼ãƒ«ã€MCP ã‚µãƒ¼ãƒãƒ¼è¨­å®š

### å‰ææ¡ä»¶
- Claude API ã‚­ãƒ¼(Anthropic API ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ)
- Claude Opus 4.5 ã¾ãŸã¯ Claude Sonnet 4.5 ä»¥ä¸Š
- ãƒ™ãƒ¼ã‚¿ãƒ˜ãƒƒãƒ€å¯¾å¿œã® API ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ(anthropic-sdk æœ€æ–°ç‰ˆ)
- Node.js v22 ä»¥ä¸Š ã¾ãŸã¯ Python 3.10 ä»¥ä¸Š

## 2. è¦ä»¶ã¨åˆ¶ç´„

| ID | ç¨®åˆ¥ | å†…å®¹ | å„ªå…ˆåº¦ |
|----|------|------|--------|
| REQ-001 | è¦ä»¶ | Tool Search Tool ã®ãƒ†ã‚¹ãƒˆå®Ÿè£…ãŒå®Œäº†ã™ã‚‹ã“ã¨ | é«˜ |
| REQ-002 | è¦ä»¶ | 3-5 å€‹ã®æœ€é »ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ã‚’éé…å»¶ã«è¨­å®šã™ã‚‹ã“ã¨ | é«˜ |
| REQ-003 | è¦ä»¶ | Regex ã¨ BM25 ã®ä¸¡ãƒãƒªã‚¢ãƒ³ãƒˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ | ä¸­ |
| REQ-004 | è¦ä»¶ | MCP ã‚µãƒ¼ãƒãƒ¼ã¨ã®çµ±åˆã‚’ãƒ†ã‚¹ãƒˆã™ã‚‹ã“ã¨ | ä¸­ |
| REQ-005 | è¦ä»¶ | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆãƒ»å®Ÿè£…ä¾‹ã®æä¾› | ä¸­ |
| REQ-006 | è¦ä»¶ | ã‚³ã‚¹ãƒˆ(ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»)ã‚’æ¸¬å®šã™ã‚‹ã“ã¨ | ä¸­ |
| REQ-007 | è¦ä»¶ | ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®šã¨æ¯”è¼ƒã‚·ãƒŠãƒªã‚ªã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ | é«˜ |
| REQ-008 | è¦ä»¶ | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥ã‚’å®Ÿè£…ã™ã‚‹ã“ã¨ | é«˜ |
| REQ-009 | è¦ä»¶ | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ç§˜å¯†æƒ…å ±ç®¡ç†æ–¹é‡ã®ç­–å®š | é«˜ |
| CON-001 | åˆ¶ç´„ | Haiku ãƒ¢ãƒ‡ãƒ«ã¯å¯¾å¿œä¸å¯(Opus/Sonnet ã®ã¿) | - |
| CON-002 | åˆ¶ç´„ | ãƒ™ãƒ¼ã‚¿æ©Ÿèƒ½ã®ãŸã‚ä»•æ§˜å¤‰æ›´ã®å¯èƒ½æ€§ | - |
| CON-003 | åˆ¶ç´„ | tool_choice: any ã¨ã®ä½µç”¨ä¸å¯ | - |
| CON-004 | åˆ¶ç´„ | ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’æä¾›ã™ã‚‹å¿…è¦ãŒã‚ã‚‹ | - |
| GUD-001 | ã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³ | 10 å€‹æœªæº€ã®ãƒ„ãƒ¼ãƒ«ã§ã¯å¾“æ¥æ–¹å¼ã‚’æ¨å¥¨ | - |

## 3. Tool Search Tool ã®é‡è¦æƒ…å ±

### 3.1 æ©Ÿèƒ½æ¦‚è¦

Tool Search Tool ã¯ Claude ãŒå¤§è¦æ¨¡ãªãƒ„ãƒ¼ãƒ«ç’°å¢ƒã§ä»¥ä¸‹ã‚’å®Ÿç¾ã—ã¾ã™ï¼š

- **ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆåŠ¹ç‡åŒ–**: ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’ã™ã¹ã¦èª­ã¿è¾¼ã¾ãšã€å¿…è¦ãªãƒ„ãƒ¼ãƒ«ã®ã¿èª­ã¿è¾¼ã¿
- **ç²¾åº¦å‘ä¸Š**: 30-50 å€‹ä»¥ä¸Šã®ãƒ„ãƒ¼ãƒ«ã§ã‚‚ç²¾åº¦ãŒä½ä¸‹ã—ãªã„
- **å‹•çš„ç™ºè¦‹**: ãƒ¦ãƒ¼ã‚¶ãƒ¼è¦æ±‚ã«å¿œã˜ãŸãƒ„ãƒ¼ãƒ«ã®è‡ªå‹•æ¤œç´¢

**ãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›åŠ¹æœ**: 50 ãƒ„ãƒ¼ãƒ« â‰ˆ 10-20K ãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›

### 3.2 2 ã¤ã®æ¤œç´¢ãƒãƒªã‚¢ãƒ³ãƒˆ

| ãƒãƒªã‚¢ãƒ³ãƒˆ | æ¤œç´¢æ–¹å¼ | ç”¨é€” | ç‰¹å¾´ |
|----------|--------|------|------|
| Regex(æ­£è¦è¡¨ç¾) | Python `re.search()` | ãƒ„ãƒ¼ãƒ«åãŒè¦å‰‡æ€§ã‚ã‚‹å ´åˆ | ã‚·ãƒ³ãƒ—ãƒ«ã€é«˜é€Ÿ |
| BM25 | è‡ªç„¶è¨€èªã‚¯ã‚¨ãƒª | ã‚»ãƒãƒ³ãƒ†ã‚£ãƒƒã‚¯æ¤œç´¢ | æŸ”è»Ÿã€é«˜ç²¾åº¦ |

### 3.3 API ä»•æ§˜

âš ï¸ **é‡è¦**: ä»¥ä¸‹ã®ãƒ™ãƒ¼ã‚¿ä»•æ§˜ã¯2025å¹´12æœˆ8æ—¥æ™‚ç‚¹ã§ã®è¨˜è¼‰ã§ã™ã€‚TASK-001ã§å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆã¨ã®çªåˆã‚’å®Ÿæ–½ã—ã€`docs/beta-spec-verification.md` ã«ç¢ºèªçµæœã‚’è¨˜éŒ²ã—ã¦ã‹ã‚‰å®Ÿè£…ã‚’é–‹å§‹ã—ã¦ãã ã•ã„ã€‚

**ãƒ™ãƒ¼ã‚¿ãƒ˜ãƒƒãƒ€:**
```
Claude API: advanced-tool-use-2025-11-20
Vertex AI: tool-search-tool-2025-10-19
Bedrock: tool-search-tool-2025-10-19
MCP Client: mcp-client-2025-11-20
```

**å¯¾å¿œãƒ¢ãƒ‡ãƒ«ãƒ»SDK ãƒãƒ¼ã‚¸ãƒ§ãƒ³:**

| ãƒ—ãƒ©ãƒƒãƒˆãƒ•ã‚©ãƒ¼ãƒ  | ãƒ¢ãƒ‡ãƒ« | æœ€å°SDKãƒãƒ¼ã‚¸ãƒ§ãƒ³ | ãƒ™ãƒ¼ã‚¿ãƒ˜ãƒƒãƒ€ |
|----------------|--------|-----------------|-------------|
| Claude API | claude-opus-4-5 | anthropic-sdk-python >= 0.39.0 | advanced-tool-use-2025-11-20 |
| Claude API | claude-sonnet-4-5-20250929 | anthropic-sdk-python >= 0.39.0 | advanced-tool-use-2025-11-20 |
| Claude API | claude-opus-4-5 | @anthropic-ai/sdk >= 0.32.0 | advanced-tool-use-2025-11-20 |
| Claude API | claude-sonnet-4-5-20250929 | @anthropic-ai/sdk >= 0.32.0 | advanced-tool-use-2025-11-20 |
| Vertex AI | claude-opus@v1 | - | tool-search-tool-2025-10-19 |
| Bedrock | anthropic.claude-opus-v1 | boto3 >= 1.35.0 | tool-search-tool-2025-10-19 |

**ãƒ„ãƒ¼ãƒ«å®šç¾©ã®é‡è¦ãƒ‘ãƒ©ãƒ¡ãƒ¼ã‚¿:**
- `defer_loading: true` - é…å»¶èª­ã¿è¾¼ã¿(Tool Search ã§æ¤œå‡ºã•ã‚Œã‚‹ã¾ã§èª­ã¿è¾¼ã¾ãªã„)
- Tool Search Tool è‡ªä½“ã«ã¯ `defer_loading` ã‚’è¨­å®šã—ãªã„(å¸¸ã«èª­ã¿è¾¼ã‚€)
- æœ€é »ä½¿ç”¨ 3-5 ãƒ„ãƒ¼ãƒ«ã¯éé…å»¶ã«ã—ã¦ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

## 4. æ¸¬å®šè¨­è¨ˆ

### 4.1 ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®š

Tool Search Tool ã®åŠ¹æœã‚’å®šé‡çš„ã«è©•ä¾¡ã™ã‚‹ãŸã‚ã€å¾“æ¥æ–¹å¼ã§ã®ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ã‚’æ¸¬å®šã—ã¾ã™ã€‚

| æ¸¬å®šé …ç›® | æ¸¬å®šæ–¹æ³• | ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ç’°å¢ƒ |
|---------|---------|----------------|
| ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»é‡ | API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã® `usage` ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ | å¾“æ¥æ–¹å¼ï¼ˆå…¨ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’æ¯å›é€ä¿¡ï¼‰ |
| ãƒ„ãƒ¼ãƒ«é¸æŠç²¾åº¦ | é©åˆ‡ãªãƒ„ãƒ¼ãƒ«ãŒé¸æŠã•ã‚ŒãŸå‰²åˆ | äººæ‰‹ã§è©•ä¾¡ã—ãŸã‚´ãƒ¼ãƒ«ãƒ‰ã‚¹ã‚¿ãƒ³ãƒ€ãƒ¼ãƒ‰ |
| ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶ | API å‘¼ã³å‡ºã—é–‹å§‹ã‹ã‚‰å®Œäº†ã¾ã§ã®æ™‚é–“ | å¾“æ¥æ–¹å¼ã§ã® p50/p95/p99 |
| ã‚¨ãƒ©ãƒ¼ç‡ | ã‚¨ãƒ©ãƒ¼å¿œç­”ã®å‰²åˆ | å¾“æ¥æ–¹å¼ã§ã®ã‚¨ãƒ©ãƒ¼ç‡ |

### 4.2 æ¯”è¼ƒã‚·ãƒŠãƒªã‚ªã¨è¨ˆæ¸¬æ¡ä»¶

#### å…±é€šè¨­å®šï¼ˆå…¨ã‚·ãƒŠãƒªã‚ªå…±é€šï¼‰

| è¨­å®šé …ç›® | å€¤ | å‚™è€ƒ |
|---------|-----|------|
| ãƒ¢ãƒ‡ãƒ« | `claude-sonnet-4-5-20250929` | Opus 4.5 ã§ã®æ¤œè¨¼ã¯è¿½åŠ æ¸¬å®š |
| SDK | Python: `anthropic-sdk-python >= 0.39.0` | ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ”ãƒ³ç•™ã‚å¿…é ˆ |
| æ¸©åº¦ï¼ˆtemperatureï¼‰ | `1.0` | ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆå€¤ã‚’ä½¿ç”¨ |
| max_tokens | `2048` | æ¨™æº–çš„ãªå¿œç­”é•·ã‚’æƒ³å®š |
| ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° | ç„¡åŠ¹ï¼ˆ`stream=False`ï¼‰ | æ¸¬å®šã®ç°¡ç´ åŒ–ã®ãŸã‚ |
| ãƒªãƒˆãƒ©ã‚¤ | æœ‰åŠ¹ï¼ˆæœ€å¤§3å›ã€exponential backoffï¼‰ | ä¸€æ™‚çš„ãªã‚¨ãƒ©ãƒ¼ã‚’é™¤å¤– |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | 30ç§’ | APIå¿œç­”ã‚’å¾…ã¤æœ€å¤§æ™‚é–“ |
| å®Ÿè¡Œç’°å¢ƒ | DevContainer (Ubuntu 24.04, Node.js v22+) | ç’°å¢ƒä¾å­˜æ€§ã‚’æ’é™¤ |

#### ã‚·ãƒŠãƒªã‚ªåˆ¥è¨­å®š

| ã‚·ãƒŠãƒªã‚ªID | èª¬æ˜ | ãƒ„ãƒ¼ãƒ«æ•° | Tool Searchè¨­å®š | æ¸¬å®šå¯¾è±¡ |
|-----------|------|---------|----------------|---------|
| SCENARIO-001 | å¾“æ¥æ–¹å¼ï¼ˆãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ï¼‰ | 10, 30, 50 | ä½¿ç”¨ã—ãªã„ï¼ˆå…¨ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’é€ä¿¡ï¼‰ | ãƒˆãƒ¼ã‚¯ãƒ³ã€é…å»¶ã€ç²¾åº¦ |
| SCENARIO-002 | Tool Search - Regex | 10, 30, 50 | `tool_search_tool_regex_20251119` + `defer_loading: true` | ãƒˆãƒ¼ã‚¯ãƒ³ã€é…å»¶ã€ç²¾åº¦ |
| SCENARIO-003 | Tool Search - BM25 | 10, 30, 50 | `tool_search_tool_bm25_20251119` + `defer_loading: true` | ãƒˆãƒ¼ã‚¯ãƒ³ã€é…å»¶ã€ç²¾åº¦ |
| SCENARIO-004 | MCPçµ±åˆ + Tool Search | 50+ (è¤‡æ•°MCP) | BM25 + `mcp_toolset` + `defer_loading: true` | ãƒˆãƒ¼ã‚¯ãƒ³ã€é…å»¶ã€ç²¾åº¦ |

**ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆæ§‹æˆï¼ˆå„ãƒ„ãƒ¼ãƒ«æ•°åˆ¥ï¼‰:**
- 10å€‹: åŸºæœ¬CRUD + æ¤œç´¢ç³»
- 30å€‹: åŸºæœ¬CRUD + æ¤œç´¢ç³» + ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰API
- 50å€‹: åŸºæœ¬CRUD + æ¤œç´¢ç³» + ãƒ‰ãƒ¡ã‚¤ãƒ³å›ºæœ‰API + MCPçµ±åˆãƒ„ãƒ¼ãƒ«

**éé…å»¶ãƒ„ãƒ¼ãƒ«ï¼ˆdefer_loading: falseï¼‰:**
- ã‚·ãƒŠãƒªã‚ª002/003/004: æœ€é »ä½¿ç”¨ãƒ„ãƒ¼ãƒ«3å€‹ï¼ˆget_user_info, search_documents, list_itemsï¼‰

### 4.3 è©•ä¾¡ç”¨ã‚´ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä»•æ§˜

**ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹**: `data/tool-search-gold.jsonl`

**å½¢å¼**: JSONLï¼ˆ1è¡Œ1ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ï¼‰

**ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹æ•°**: 90ä»¶ä»¥ä¸Šï¼ˆãƒ„ãƒ¼ãƒ«æ•°åˆ¥: 10å€‹Ã—30ä»¶ã€30å€‹Ã—30ä»¶ã€50å€‹Ã—30ä»¶ï¼‰

**ã‚¹ã‚­ãƒ¼ãƒ**:
```json
{
  "id": "test-001",
  "query": "ãƒ¦ãƒ¼ã‚¶ãƒ¼ã®æƒ…å ±ã‚’å–å¾—ã—ã¦ãã ã•ã„",
  "tool_count": 30,
  "expected_tools": ["get_user_info", "fetch_user_profile"],
  "category": "user_management",
  "difficulty": "easy"
}
```

**ãƒ¡ãƒ³ãƒ†ãƒŠãƒ³ã‚¹æ‰‹é †**:
- æ–°è¦ãƒ„ãƒ¼ãƒ«è¿½åŠ æ™‚: é–¢é€£ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’è¿½åŠ 
- å››åŠæœŸã”ã¨ã«ãƒ¬ãƒ“ãƒ¥ãƒ¼ãƒ»æ›´æ–°

#### ãƒ„ãƒ¼ãƒ«å®šç¾©ã®ä¾›çµ¦å…ƒï¼ˆCIãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ï¼‰

| ä¾›çµ¦å…ƒ | å ´æ‰€ | æ›´æ–°ã‚¿ã‚¤ãƒŸãƒ³ã‚° | ç”¨é€” |
|--------|------|--------------|------|
| é™çš„å®šç¾© | `scripts/mock-tools.json` | ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ä½œæˆæ™‚ | CIãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ç”¨ã‚¹ã‚¿ãƒ– |
| æœ¬ç•ªå®šç¾© | `agents/` + MCP servers | TASK-014/015å¾Œ | çµ±åˆãƒ†ã‚¹ãƒˆç”¨å®Ÿãƒ‡ãƒã‚¤ã‚¹ |

**åˆæœŸãƒ•ã‚§ãƒ¼ã‚ºï¼ˆPhase 1ï¼‰**: ã‚¹ã‚¿ãƒ–ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’ `scripts/mock-tools.json` ã«æä¾›
**çµ±åˆãƒ•ã‚§ãƒ¼ã‚ºï¼ˆPhase 2ä»¥é™ï¼‰**: å®Ÿè£…ã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’å‚ç…§

**ãƒ„ãƒ¼ãƒ«å®šç¾©ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆï¼ˆmock-tools.jsonï¼‰**:
```json
{
  "tools": [
    {
      "name": "get_user_info",
      "description": "Retrieve user information",
      "input_schema": {
        "type": "object",
        "properties": {
          "user_id": {"type": "string"}
        },
        "required": ["user_id"]
      }
    }
  ]
}
```

#### ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆæ›´æ–°æ™‚ã®CIãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³

PRä½œæˆæ™‚ã«ä»¥ä¸‹ã®è‡ªå‹•ãƒã‚§ãƒƒã‚¯ã‚’å®Ÿæ–½ï¼š

```yaml
# .github/workflows/validate-gold-dataset.yml
name: Validate Gold Dataset

on:
  pull_request:
    paths:
      - 'data/tool-search-gold.jsonl'

jobs:
  validate:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - name: Validate JSON Schema
        run: |
          # å„è¡ŒãŒæœ‰åŠ¹ãªJSONã‹ç¢ºèª
          # å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ï¼ˆid, query, tool_count, expected_toolsï¼‰ãŒå­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
          python scripts/validate-gold-dataset.py --schema

      - name: Check Duplicate IDs
        run: |
          # ID ã®é‡è¤‡ã‚’æ¤œå‡º
          python scripts/validate-gold-dataset.py --duplicates

      - name: Verify Expected Tools Exist
        run: |
          # expected_tools ã«æŒ‡å®šã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«åãŒå®Ÿéš›ã®ãƒ„ãƒ¼ãƒ«å®šç¾©ã«å­˜åœ¨ã™ã‚‹ã‹ç¢ºèª
          python scripts/validate-gold-dataset.py --tools

      - name: Check Test Case Balance
        run: |
          # ãƒ„ãƒ¼ãƒ«æ•°åˆ¥ã®åˆ†å¸ƒãŒé©åˆ‡ã‹ç¢ºèªï¼ˆ10å€‹Ã—30ä»¶ã€30å€‹Ã—30ä»¶ã€50å€‹Ã—30ä»¶ï¼‰
          python scripts/validate-gold-dataset.py --balance
```

**ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ**: `scripts/validate-gold-dataset.py`

**ãƒã‚§ãƒƒã‚¯å†…å®¹:**

| ãƒã‚§ãƒƒã‚¯é …ç›® | æ¤œè¨¼å†…å®¹ | ã‚¨ãƒ©ãƒ¼æ™‚ã®æŒ™å‹• |
|------------|---------|--------------|
| JSONã‚¹ã‚­ãƒ¼ãƒ | å¿…é ˆãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã®å­˜åœ¨ã€å‹ã®å¦¥å½“æ€§ | CIå¤±æ•—ã€PR ãƒãƒ¼ã‚¸ä¸å¯ |
| IDé‡è¤‡ãƒã‚§ãƒƒã‚¯ | åŒä¸€IDã®è¤‡æ•°ä½¿ç”¨ã‚’æ¤œå‡º | CIå¤±æ•—ã€PR ãƒãƒ¼ã‚¸ä¸å¯ |
| ãƒ„ãƒ¼ãƒ«åå­˜åœ¨ç¢ºèª | expected_tools ã®ãƒ„ãƒ¼ãƒ«å®šç¾©å­˜åœ¨ | CIå¤±æ•—ã€PR ãƒãƒ¼ã‚¸ä¸å¯ |
| ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ãƒãƒ©ãƒ³ã‚¹ | ãƒ„ãƒ¼ãƒ«æ•°åˆ¥ã®åˆ†å¸ƒï¼ˆ10/30/50å€‹ï¼‰ | è­¦å‘Šï¼ˆãƒãƒ¼ã‚¸ã¯å¯èƒ½ï¼‰ |
| difficultyå¦¥å½“æ€§ | easy/medium/hard ã®ã„ãšã‚Œã‹ | è­¦å‘Šï¼ˆãƒãƒ¼ã‚¸ã¯å¯èƒ½ï¼‰ |

**å®Œäº†æ¡ä»¶:**
- [ ] ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ãŒè¨­å®šã•ã‚Œã¦ã„ã‚‹
- [ ] PRã§ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¨ãƒ©ãƒ¼ãŒç™ºç”Ÿã—ãŸéš›ã«ãƒãƒ¼ã‚¸ãŒãƒ–ãƒ­ãƒƒã‚¯ã•ã‚Œã‚‹
- [ ] è­¦å‘Šãƒ¬ãƒ™ãƒ«ã®ã‚¨ãƒ©ãƒ¼ã¯è¨˜éŒ²ã•ã‚Œã‚‹ãŒãƒãƒ¼ã‚¸ã¯å¯èƒ½

### 4.4 è¨ˆæ¸¬ã‚³ã‚¹ãƒˆãƒ»æ™‚é–“è¦‹ç©ã‚‚ã‚Š

#### ç·ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°

| ãƒ•ã‚§ãƒ¼ã‚º | å›æ•° | è¨ˆç®—æ ¹æ‹  |
|---------|------|---------|
| ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ— | 12 | 3å› Ã— 4ã‚·ãƒŠãƒªã‚ª |
| æœ¬æ¸¬å®š | 120 | 30ã‚µãƒ³ãƒ—ãƒ« Ã— 4ã‚·ãƒŠãƒªã‚ª |
| ãƒªãƒˆãƒ©ã‚¤ï¼ˆæœ€æ‚ªã‚±ãƒ¼ã‚¹ï¼‰ | 360 | 120 Ã— æœ€å¤§3å› |
| **åˆè¨ˆ** | **492** | - |

#### ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»ã¨å®Ÿè¡Œã‚³ã‚¹ãƒˆ

- å¹³å‡ãƒˆãƒ¼ã‚¯ãƒ³/ãƒªã‚¯ã‚¨ã‚¹ãƒˆ: 2,000ï¼ˆãƒ„ãƒ¼ãƒ«å®šç¾©å«ã‚€ï¼‰
- ç·ãƒˆãƒ¼ã‚¯ãƒ³: 984,000
- **æ¨å®šAPIå®Ÿè¡Œã‚³ã‚¹ãƒˆ**: $3.75 ~ $4.50

#### å®Ÿè¡Œæ™‚é–“

- ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–“éš”: 1ç§’ï¼ˆrate limité…æ…®ï¼‰
- é€£ç¶šå®Ÿè¡Œæ™‚: ç´„8.2åˆ†ï¼ˆ492ç§’ï¼‰
- **æ¨å¥¨å®Ÿè¡Œ**: é€šå¸¸ã®å–¶æ¥­æ™‚é–“å†…ã§å®Ÿè¡Œå¯èƒ½ã€‚åˆå›ã¯ãƒ†ã‚¹ãƒˆç’°å¢ƒã§10ã‚µãƒ³ãƒ—ãƒ«/ã‚·ãƒŠãƒªã‚ªã‚’è©¦è¡Œæ¨å¥¨

#### Rate Limit é…æ…®

| Limit | è¨­å®šå€¤ | é…æ…®å†…å®¹ |
|-------|--------|---------|
| RPM | 10,000 | 492ãƒªã‚¯ã‚¨ã‚¹ãƒˆ â‰ˆ 1åˆ†ã§ã‚«ãƒãƒ¼ï¼ˆä½™è£•ã‚ã‚Šï¼‰ |
| TPM | 1,000,000 | 984,000ãƒˆãƒ¼ã‚¯ãƒ³ â‰ˆ 1åˆ†ã§ã‚«ãƒãƒ¼ï¼ˆé™ç•Œå€¤è¿‘å‚ï¼‰ |
| **æ¨å¥¨å®Ÿè¡Œæˆ¦ç•¥** | ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–“éš”1ç§’ + TPMç›£è¦– | TPMè¿‘å‚æ™‚ã¯è¿½åŠ å¾…æ©Ÿï¼ˆ10ç§’é–“éš”ã«å»¶é•·ï¼‰ã§ãƒ¬ãƒ¼ãƒˆåˆ¶é™å›é¿ |

#### è¨ˆæ¸¬å®Ÿè¡Œæ™‚ã®æ³¨æ„

- åˆå›å®Ÿè¡Œæ™‚ã¯æœ¬ç•ªç’°å¢ƒã§ã® rate limit å½±éŸ¿ã‚’è€ƒæ…®ã—ã€ãƒ†ã‚¹ãƒˆç’°å¢ƒã§ 10ã‚µãƒ³ãƒ—ãƒ«/ã‚·ãƒŠãƒªã‚ªã§è©¦è¡Œå®Ÿè¡Œæ¨å¥¨
- æœ¬æ¸¬å®šã¯ç´„8.2åˆ†ã§å®Œäº†ã™ã‚‹ãŒã€TPMåˆ¶é™ï¼ˆ984,000ãƒˆãƒ¼ã‚¯ãƒ³/åˆ†ï¼‰ã«è¿‘ã„ãŸã‚ã€ãƒªã‚¢ãƒ«ã‚¿ã‚¤ãƒ ã§TPMä½¿ç”¨é‡ã‚’ç›£è¦–ã—ã€å¿…è¦ã«å¿œã˜ã¦ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–“éš”ã‚’å»¶é•·
- å®Ÿè¡Œä¸­ã¯ `watch -n1 'tail -f logs/measure-performance.log'` ã§ç›£è¦–

### 4.5 è¨ˆæ¸¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆ

ä»¥ä¸‹ã®ã‚¹ã‚¯ãƒªãƒ—ãƒˆã‚’ä½œæˆã—ã€è‡ªå‹•æ¸¬å®šã‚’å®Ÿç¾ã—ã¾ã™ï¼š

```python
# scripts/measure-performance.py
# - data/tool-search-gold.jsonl ã‹ã‚‰ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã‚’èª­è¾¼
# - å„ã‚·ãƒŠãƒªã‚ªã§ã®ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»é‡ã‚’æ¸¬å®š
# - ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ™‚é–“ï¼ˆp50/p95/p99ï¼‰ã‚’è¨˜éŒ²
# - ãƒ„ãƒ¼ãƒ«é¸æŠç²¾åº¦ã‚’è¨ˆç®—ï¼ˆé©åˆç‡ãƒ»å†ç¾ç‡ï¼‰
# - çµæœã‚’CSV/JSONã§å‡ºåŠ›ï¼ˆresults/performance-YYYYMMDD.csvï¼‰
```

#### è¨ˆæ¸¬ã‚¹ã‚¯ãƒªãƒ—ãƒˆã®è¦ä»¶

| è¨­å®šé …ç›® | å€¤ | ç†ç”± |
|---------|-----|------|
| ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—å›æ•° | 3å› | åˆå›ã®ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ§‹ç¯‰ã‚„æ¥ç¶šç¢ºç«‹ã‚’é™¤å¤–ã™ã‚‹ãŸã‚ |
| æœ€å°ã‚µãƒ³ãƒ—ãƒ«æ•° | 30ä»¶/ã‚·ãƒŠãƒªã‚ª | çµ±è¨ˆçš„ã«æœ‰æ„ãªçµæœã‚’å¾—ã‚‹ãŸã‚ï¼ˆp95/p99è¨ˆç®—ï¼‰ |
| ãƒªãƒˆãƒ©ã‚¤å›æ•° | æœ€å¤§3å› | ä¸€æ™‚çš„ãªãƒãƒƒãƒˆãƒ¯ãƒ¼ã‚¯ã‚¨ãƒ©ãƒ¼ã‚’é™¤å¤– |
| ãƒªãƒˆãƒ©ã‚¤é–“éš” | Exponential backoffï¼ˆ1ç§’ã€2ç§’ã€4ç§’ï¼‰ | API rate limitã‚’è€ƒæ…® |
| ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ | 30ç§’/ãƒªã‚¯ã‚¨ã‚¹ãƒˆ | é•·æ™‚é–“ãƒãƒ³ã‚°ã‚’é˜²ã |
| ã‚¨ãƒ©ãƒ¼æ™‚ã®å‡¦ç† | ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ² + æ¬¡ã®ã‚µãƒ³ãƒ—ãƒ«ã¸ç¶™ç¶š | éƒ¨åˆ†çš„ãªçµæœã§ã‚‚å–å¾—å¯èƒ½ã« |
| å®Ÿè¡Œé–“éš” | 1ç§’ï¼ˆãƒªã‚¯ã‚¨ã‚¹ãƒˆé–“ï¼‰ | API rate limitã‚’è€ƒæ…® |

**å®Œäº†æ¡ä»¶:**
- [ ] ã‚¦ã‚©ãƒ¼ãƒ ã‚¢ãƒƒãƒ—é™¤å¤–ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] æœ€å°ã‚µãƒ³ãƒ—ãƒ«æ•°ï¼ˆ30ä»¶ï¼‰ãŒç¢ºä¿ã•ã‚Œã¦ã„ã‚‹
- [ ] ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯ã¨exponential backoffï¼ˆ1ç§’ã€2ç§’ã€4ç§’ï¼‰ãŒå®Ÿè£…ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆè¨­å®šï¼ˆ30ç§’/ãƒªã‚¯ã‚¨ã‚¹ãƒˆï¼‰ãŒé©ç”¨ã•ã‚Œã¦ã„ã‚‹
- [ ] ã‚¨ãƒ©ãƒ¼ç™ºç”Ÿæ™‚ã‚‚ã‚¹ã‚¯ãƒªãƒ—ãƒˆãŒç¶™ç¶šå®Ÿè¡Œã•ã‚Œã‚‹
- [ ] æ¸¬å®šçµæœã«çµ±è¨ˆæƒ…å ±ï¼ˆå¹³å‡ã€ä¸­å¤®å€¤ã€p50/p95/p99ï¼‰ãŒå«ã¾ã‚Œã‚‹
- [ ] TPMä½¿ç”¨é‡ã‚’ç›£è¦–ã—ã€åˆ¶é™è¿‘å‚æ™‚ã«ãƒªã‚¯ã‚¨ã‚¹ãƒˆé–“éš”ã‚’é©å¿œçš„ã«å»¶é•·ï¼ˆ1ç§’â†’10ç§’ï¼‰
- [ ] ãƒ¬ãƒ¼ãƒˆåˆ¶é™ã‚¨ãƒ©ãƒ¼ï¼ˆ429ï¼‰ã‚’æ¤œå‡ºã—ãŸã‚‰è‡ªå‹•åœæ­¢ãƒ»ãƒ­ã‚°å‡ºåŠ›
- [ ] å®Ÿè¡Œçµ±è¨ˆï¼ˆå®Ÿãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•°ã€å®Ÿãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»ã€å®Ÿè¡Œæ™‚é–“ã€TPMä½¿ç”¨ç‡ï¼‰ã‚’ãƒ­ã‚°å‡ºåŠ›

### 4.6 è©•ä¾¡æŒ‡æ¨™

| æŒ‡æ¨™ | è¨ˆç®—æ–¹æ³• | ç›®æ¨™å€¤ |
|-----|---------|--------|
| ãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›ç‡ | (ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ - Tool Search) / ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³ Ã— 100% | 20-30% |
| ãƒ„ãƒ¼ãƒ«é¸æŠé©åˆç‡ | æ­£ã—ãé¸æŠã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«æ•° / é¸æŠã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«æ•° | >= 90% |
| ãƒ„ãƒ¼ãƒ«é¸æŠå†ç¾ç‡ | æ­£ã—ãé¸æŠã•ã‚ŒãŸãƒ„ãƒ¼ãƒ«æ•° / é¸æŠã™ã¹ããƒ„ãƒ¼ãƒ«æ•° | >= 85% |
| p95 ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶ | 95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«å€¤ | <= 1.5ç§’ |
| p99 ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶ | 99ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ«å€¤ | <= 3.0ç§’ |

### 4.7 éé…å»¶ãƒ„ãƒ¼ãƒ«é¸å®šãƒ—ãƒ­ã‚»ã‚¹

æœ€é »ä½¿ç”¨ãƒ„ãƒ¼ãƒ«ï¼ˆéé…å»¶è¨­å®šï¼‰ã®é¸å®šã¯ä»¥ä¸‹ã®ãƒ—ãƒ­ã‚»ã‚¹ã§å®Ÿæ–½ï¼š

#### ãƒ­ã‚°ä»•æ§˜ï¼ˆTASK-006ã§å‚ç…§ï¼‰

**ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«å ´æ‰€**: `logs/api-calls.jsonl`
**å½¢å¼**: JSONLï¼ˆ1è¡Œ1 APIå‘¼ã³å‡ºã—ï¼‰

**ã‚¹ã‚­ãƒ¼ãƒ**:
```json
{
  "timestamp": "2025-12-08T14:30:00Z",
  "user_id": "user_123",
  "tool_name": "get_user_info",
  "status": "success",
  "duration_ms": 245,
  "tokens": {
    "input": 500,
    "output": 200
  }
}
```

**ä¿æŒæœŸé–“**: 30æ—¥ï¼ˆãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼‰

#### åˆæœŸå€¤é¸å®šï¼ˆãƒ­ã‚°ãªã—æ™‚ã®ä»£æ›¿ï¼‰

**ã‚¿ã‚¤ãƒ ãƒ©ã‚¤ãƒ³**:
1. **åˆæœŸï¼ˆè¨ˆç”»é–‹å§‹æ™‚ï¼‰**: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä¸Šã®æƒ³å®šã§å›ºå®š
   - æ¨å®šä¸Šä½3ãƒ„ãƒ¼ãƒ«: `get_user_info`, `search_documents`, `list_items`
   - ç†ç”±: ä¸€èˆ¬çš„ãªCRUDæ“ä½œã®é »åº¦ãŒé«˜ã„ã¨æƒ³å®š
   - æœ‰åŠ¹æœŸé™: Phase 1 æœŸé–“ï¼ˆ1é€±é–“ï¼‰

2. **Phase 2ä»¥é™**: å®Ÿãƒ­ã‚°ã«åŸºã¥ã„ã¦æ›´æ–°
   - å®Ÿæ–½ã‚¿ã‚¤ãƒŸãƒ³ã‚°: Phase 2 é–‹å§‹å¾Œ 2é€±é–“ï¼ˆTASK-006å®Ÿæ–½æ™‚ç‚¹ï¼‰
   - é›†è¨ˆæ–¹æ³•: APIå‘¼ã³å‡ºã—é »åº¦ã®é™é †ã€ç´¯ç©ä½¿ç”¨ç‡60%ä»¥ä¸Šã‚’ã‚«ãƒãƒ¼

3. **æœ¬ç•ªé‹ç”¨**: æœˆæ¬¡ãƒ¬ãƒ“ãƒ¥ãƒ¼
   - æ›´æ–°é »åº¦: æœˆæ¬¡ã§ãƒ¬ãƒ“ãƒ¥ãƒ¼ã€å››åŠæœŸã§è¦‹ç›´ã—
   - åˆ¤å®šåŸºæº–: ç´¯ç©ä½¿ç”¨ç‡ãŒä¸‹ä½ãƒ„ãƒ¼ãƒ«ã«ç§»ã£ãŸå ´åˆã«æ›´æ–°

## 5. å®Ÿè£…ã‚¹ãƒ†ãƒƒãƒ—

### Phase 1: åŸºæœ¬æ¤œè¨¼ãƒ»æ¸¬å®šè¨­è¨ˆ
**ç›®æ¨™**: Tool Search Tool ã®å‹•ä½œç¢ºèªã€ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®šã€ãƒ™ã‚¹ãƒˆå®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ç¿’å¾—

#### ã‚¹ãƒ†ãƒƒãƒ— 1a: ç’°å¢ƒæº–å‚™ï¼ˆä¸¦è¡Œå¯èƒ½ï¼‰

| ã‚¿ã‚¹ã‚¯ID | å†…å®¹ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | å®Œäº†æ¡ä»¶ | ä¾å­˜ | çŠ¶æ…‹ |
|----------|------|-------------|---------|------|------|
| TASK-001 | ãƒ™ãƒ¼ã‚¿ç‰ˆä»•æ§˜ã®æœ€æ–°ç‰ˆç¢ºèª | `docs/beta-spec-verification.md` | å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆçªåˆå®Œäº† | - | [ ] |
| TASK-002 | API ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç²¾èª­ | - | ç²¾èª­å®Œäº† | - | [ ] |
| TASK-003 | ã‚´ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä½œæˆ | `data/tool-search-gold.jsonl` | 90ä»¶ä»¥ä¸Šã®ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ + mock-tools.json | - | [ ] |
| TASK-004 | SDK ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªãƒ»ãƒ”ãƒ³ç•™ã‚ | `package.json` / `pyproject.toml` | ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®šã€æ¤œè¨¼å®Œäº† | TASK-001 | [ ] |

**é–‹å§‹æ¡ä»¶**: TASK-001/002 ã‚’å¾…ãŸãšã« 003/004 ã¯ä¸¦è¡Œå®Ÿæ–½å¯èƒ½
**çµ‚äº†æ¡ä»¶**: 4ã‚¿ã‚¹ã‚¯å…¨å®Œäº†å¾Œã€æ¬¡ã‚¹ãƒ†ãƒƒãƒ—ã¸

#### ã‚¹ãƒ†ãƒƒãƒ— 1b: ãƒ„ãƒ¼ãƒ«å®šç¾©æº–å‚™

| ã‚¿ã‚¹ã‚¯ID | å†…å®¹ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | å®Œäº†æ¡ä»¶ | ä¾å­˜ | çŠ¶æ…‹ |
|----------|------|-------------|---------|------|------|
| TASK-005 | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ | `scripts/validate-gold-dataset.py` | CI ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³æ•´å‚™å®Œäº† | TASK-003 | [ ] |

**çµ‚äº†æ¡ä»¶**: CI ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³æˆåŠŸå¾Œã€æ¬¡ã‚¹ãƒ†ãƒƒãƒ—ã¸

#### ã‚¹ãƒ†ãƒƒãƒ— 1c: æ¸¬å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆãƒ»å®Ÿè£…ä¾‹

| ã‚¿ã‚¹ã‚¯ID | å†…å®¹ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | å®Œäº†æ¡ä»¶ | ä¾å­˜ | çŠ¶æ…‹ |
|----------|------|-------------|---------|------|------|
| TASK-006 | ãƒ„ãƒ¼ãƒ«ä½¿ç”¨é »åº¦é›†è¨ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ | `scripts/analyze-tool-usage.py` | ã‚¹ã‚¿ãƒ–ãƒ­ã‚°å¯¾å¿œå®Œäº† | - | [ ] |
| TASK-007 | Regex å®Ÿè£…ä¾‹ | `examples/tool-search-basic-regex.py` | å‹•ä½œç¢ºèªï¼ˆmock-tools.json ã§å®Ÿè¡Œå¯ï¼‰| TASK-003 | [ ] |
| TASK-008 | BM25 å®Ÿè£…ä¾‹ | `examples/tool-search-basic-bm25.ts` | å‹•ä½œç¢ºèªï¼ˆmock-tools.json ã§å®Ÿè¡Œå¯ï¼‰ | TASK-003 | [ ] |

**ä¸¦è¡Œå®Ÿæ–½**: TASK-006, 007, 008 ã¯åŒæ™‚å®Ÿè¡Œå¯èƒ½

#### ã‚¹ãƒ†ãƒƒãƒ— 1d: ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®š

| ã‚¿ã‚¹ã‚¯ID | å†…å®¹ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | å®Œäº†æ¡ä»¶ | ä¾å­˜ | çŠ¶æ…‹ |
|----------|------|-------------|---------|------|------|
| TASK-009 | ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ | `scripts/measure-performance.py` | å¾“æ¥æ–¹å¼æ¸¬å®šãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…å®Œäº† | TASK-003 | [ ] |
| TASK-010 | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æ¤œè¨¼ | - | 400/429/200 ã‚¨ãƒ©ãƒ¼ã§å‹•ä½œç¢ºèª | TASK-009 | [ ] |

**é–‹å§‹æ¡ä»¶**: TASK-009 ã¯ TASK-003 å®Œäº†ã¨åŒæ™‚é–‹å§‹å¯
**çµ‚äº†æ¡ä»¶**: TASK-010 å®Œäº†å¾Œ Phase 1 å®Œäº†

**TASK-001: ãƒ™ãƒ¼ã‚¿ç‰ˆä»•æ§˜ã®æœ€æ–°ç‰ˆç¢ºèªãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ**

ä»¥ä¸‹ã®é …ç›®ã‚’å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ/SDK ãƒªãƒªãƒ¼ã‚¹ãƒãƒ¼ãƒˆã§ç¢ºèªã—ã€ãƒ—ãƒ©ãƒ³è¨˜è¼‰å†…å®¹ã¨çªåˆã—ã¾ã™ï¼š

- [ ] ãƒ™ãƒ¼ã‚¿ãƒ˜ãƒƒãƒ€åãŒæ­£ã—ã„ã‹
  - Claude API: `advanced-tool-use-2025-11-20`
  - Vertex AI: `tool-search-tool-2025-10-19`
  - Bedrock: `tool-search-tool-2025-10-19`
- [ ] ãƒ„ãƒ¼ãƒ«ç¨®åˆ¥åãŒæ­£ã—ã„ã‹
  - `tool_search_tool_regex_20251119`
  - `tool_search_tool_bm25_20251119`
- [ ] å¯¾å¿œãƒ¢ãƒ‡ãƒ«åãŒæ­£ã—ã„ã‹
  - `claude-opus-4-5`
  - `claude-sonnet-4-5-20250929`
- [ ] SDK æœ€å°ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãŒæœ€æ–°ã‹
  - Python: `anthropic-sdk-python >= 0.39.0`
  - TypeScript: `@anthropic-ai/sdk >= 0.32.0`
- [ ] MCP ãƒ™ãƒ¼ã‚¿ãƒ˜ãƒƒãƒ€ãŒæ­£ã—ã„ã‹
  - `mcp-client-2025-11-20`

**ç¢ºèªçµæœè¨˜éŒ²å…ˆ**: `docs/beta-spec-verification.md`

---

**è©³ç´°å®Ÿè£…ã‚¬ã‚¤ãƒ‰:**

```python
# examples/tool-search-basic-regex.py
# WARNING: Beta specification as of 2025-12-08
# Verify ãƒ„ãƒ¼ãƒ«ç¨®åˆ¥åãƒ»ãƒ™ãƒ¼ã‚¿ãƒ˜ãƒƒãƒ€ are correct before execution
# See: docs/beta-spec-verification.md

import anthropic

client = anthropic.Anthropic(api_key="YOUR_API_KEY")

tools = [
    {
        "type": "tool_search_tool_regex_20251119",
        "name": "tool_search_tool_regex"
    },
    {
        "name": "get_weather",
        "description": "Get current weather for a location",
        "input_schema": {
            "type": "object",
            "properties": {
                "location": {"type": "string", "description": "City name"}
            },
            "required": ["location"]
        },
        "defer_loading": True
    },
    {
        "name": "search_documents",
        "description": "Search documents in database",
        "input_schema": {
            "type": "object",
            "properties": {
                "query": {"type": "string"}
            },
            "required": ["query"]
        },
        "defer_loading": True
    }
]

response = client.beta.messages.create(
    model="claude-sonnet-4-5-20250929",
    betas=["advanced-tool-use-2025-11-20"],
    max_tokens=1024,
    tools=tools,
    messages=[{
        "role": "user",
        "content": "What's the weather in San Francisco?"
    }]
)

print(f"Stop reason: {response.stop_reason}")
print(f"Content: {response.content}")
print(f"Usage: {response.usage}")
```

**æ¤œè¨¼ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ:**
- [ ] API ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã« `server_tool_use` ãƒ–ãƒ­ãƒƒã‚¯ãŒå«ã¾ã‚Œã¦ã„ã‚‹
- [ ] æ¤œç´¢çµæœã« `tool_reference` ãƒ–ãƒ­ãƒƒã‚¯ãŒè¿”å´ã•ã‚Œã‚‹
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»ãŒå¾“æ¥æ–¹å¼ã‚ˆã‚Šå°‘ãªã„

### Phase 2: Agent SDK çµ±åˆãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­è¨ˆ
**ç›®æ¨™**: Claude Agent SDK ã§ã® Tool Search Tool å®Ÿè£…ã€éšœå®³æ™‚ã®ä»£æ›¿ãƒ‘ã‚¹è¨­è¨ˆ

| ã‚¿ã‚¹ã‚¯ID | å†…å®¹ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | å®Œäº†æ¡ä»¶ | çŠ¶æ…‹ |
|----------|------|-------------|---------|------|
| TASK-011 | Agent SDK ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ« | `package.json` / `pyproject.toml` | æœ€æ–°ç‰ˆã‚’å°å…¥ãƒ»ãƒãƒ¼ã‚¸ãƒ§ãƒ³å›ºå®š | [ ] |
| TASK-012 | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥è¨­è¨ˆ | `docs/fallback-strategy.md` | ãƒ™ãƒ¼ã‚¿åœæ­¢/ã‚¨ãƒ©ãƒ¼æ™‚ã®ä»£æ›¿å‡¦ç†ã‚’å®šç¾© | [ ] |
| TASK-013 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ç§˜å¯†æƒ…å ±ç®¡ç†æ–¹é‡ç­–å®š | `docs/security-policy.md` | API ã‚­ãƒ¼ç®¡ç†ã€ãƒ­ã‚°ç®¡ç†ã€æ¨©é™ç®¡ç†ã€æ›´æ–°ãƒ—ãƒ­ã‚»ã‚¹ã‚’æ˜è¨˜ï¼ˆã‚»ã‚¯ã‚·ãƒ§ãƒ³8ã®å†…å®¹ã‚’çµ±åˆï¼‰ | [ ] |
| TASK-014 | Tool Search Tool çµ±åˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆä½œæˆ | `agents/advanced-tool-search.py` | å‹•ä½œç¢ºèª | [ ] |
| TASK-015 | MCP ã‚µãƒ¼ãƒãƒ¼ã¨ã®çµ±åˆãƒ†ã‚¹ãƒˆ | `tests/mcp-integration-test.md` | `server_tool_use`/`tool_reference` ç¢ºèªã€ã‚¨ãƒ©ãƒ¼ç‡<5%ã€é…å»¶æ¸¬å®š | [ ] |
| TASK-016 | è¤‡æ•° MCP ã‚µãƒ¼ãƒãƒ¼ç’°å¢ƒã§ã®ãƒ†ã‚¹ãƒˆ | - | defer_loading ã‚’è¤‡æ•° MCP ã§è¨­å®šãƒ»ãƒ†ã‚¹ãƒˆ | [ ] |
| TASK-017 | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆ | `agents/advanced-tool-search.py` | ã‚¨ãƒ©ãƒ¼æ™‚ã«é™çš„ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã¸åˆ‡æ›¿ | [ ] |

**å®Ÿè£…ä¾‹(Python Agent SDK):**

```python
# agents/advanced-tool-search.py
from anthropic import Anthropic

def create_tool_search_agent():
    """Tool Search Tool ã‚’ä½¿ç”¨ã—ãŸã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ"""

    # 100+ ãƒ„ãƒ¼ãƒ«ãŒå­˜åœ¨ã™ã‚‹æƒ³å®š
    all_tools = [
        {
            "type": "tool_search_tool_bm25_20251119",
            "name": "tool_search_tool_bm25"
        },
        # æœ€é »ä½¿ç”¨ãƒ„ãƒ¼ãƒ«(éé…å»¶)
        {
            "name": "get_user_info",
            "description": "Retrieve user information",
            "input_schema": {
                "type": "object",
                "properties": {"user_id": {"type": "string"}},
                "required": ["user_id"]
            },
            "defer_loading": False
        },
        # ãã®ä»–ãƒ„ãƒ¼ãƒ«(é…å»¶)
        {
            "name": "get_weather",
            "description": "Get weather data",
            "input_schema": {
                "type": "object",
                "properties": {"location": {"type": "string"}},
                "required": ["location"]
            },
            "defer_loading": True
        },
        # ... 90+ more tools with defer_loading: True
    ]

    return all_tools

# Agent initialization
client = Anthropic()
tools = create_tool_search_agent()

response = client.beta.messages.create(
    model="claude-opus-4-5",
    betas=["advanced-tool-use-2025-11-20"],
    max_tokens=2048,
    tools=tools,
    messages=[{
        "role": "user",
        "content": "User 12345ã®ãƒ—ãƒ­ãƒ•ã‚£ãƒ¼ãƒ«æƒ…å ±ã¨æ±äº¬ã®å¤©æ°—ã‚’å–å¾—ã—ã¦"
    }]
)

print(response)
```

**MCP çµ±åˆãƒ†ã‚¹ãƒˆã®è¦³æ¸¬ãƒã‚¤ãƒ³ãƒˆ:**

| è¦³æ¸¬é …ç›® | ç¢ºèªæ–¹æ³• | æœŸå¾…å€¤ |
|---------|---------|--------|
| `server_tool_use` ãƒ–ãƒ­ãƒƒã‚¯ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹ç¢ºèª | å­˜åœ¨ã™ã‚‹ |
| `tool_reference` ãƒ–ãƒ­ãƒƒã‚¯ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹å†…å®¹ç¢ºèª | å‚ç…§ãƒ„ãƒ¼ãƒ«ãŒå«ã¾ã‚Œã‚‹ |
| `defer_loading` ã®åŠ¹æœ | åˆå›å‘¼ã³å‡ºã—ã§ãƒ„ãƒ¼ãƒ«å®šç¾©ãŒé€ä¿¡ã•ã‚Œãªã„ | ãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›ã‚’ç¢ºèª |
| ã‚¨ãƒ©ãƒ¼ç‡ | ã‚¨ãƒ©ãƒ¼å¿œç­”æ•° / ç·ãƒªã‚¯ã‚¨ã‚¹ãƒˆæ•° | < 5% |
| p95 ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶ | 100ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« | <= 1.5ç§’ |
| MCP ã‚µãƒ¼ãƒãƒ¼æ¥ç¶šçŠ¶æ…‹ | `mcp_servers` ãƒ¬ã‚¹ãƒãƒ³ã‚¹ | `connected` |

**ãƒ†ã‚¹ãƒˆçµæœè¨˜éŒ²å…ˆ**: `tests/mcp-integration-test.md`

### Phase 3: MCP çµ±åˆ
**ç›®æ¨™**: MCP ã‚µãƒ¼ãƒãƒ¼ã®ãƒ„ãƒ¼ãƒ«ã‚’ Tool Search Tool ã§ç®¡ç†

| ã‚¿ã‚¹ã‚¯ID | å†…å®¹ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | å®Œäº†æ¡ä»¶ | çŠ¶æ…‹ |
|----------|------|-------------|---------|------|
| TASK-018 | MCP ãƒ„ãƒ¼ãƒ«ä¸€è¦§å–å¾—ã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆ | `scripts/get-mcp-tools.py` | ã™ã¹ã¦ã® MCP ãƒ„ãƒ¼ãƒ«åˆ—æŒ™ | [ ] |
| TASK-019 | mcp_toolset ã§ã® defer_loading è¨­å®š | - | å…¨ MCP ãƒ„ãƒ¼ãƒ«ã‚’é…å»¶è¨­å®š | [ ] |
| TASK-020 | è¤‡æ•° MCP ã‚µãƒ¼ãƒãƒ¼çµ±åˆãƒ†ã‚¹ãƒˆ | - | context7 + msdocs + custom ã§å‹•ä½œç¢ºèª | [ ] |

**å®Ÿè£…ä¾‹(MCP çµ±åˆ):**

```python
response = client.beta.messages.create(
    model="claude-sonnet-4-5-20250929",
    betas=["advanced-tool-use-2025-11-20", "mcp-client-2025-11-20"],
    max_tokens=2048,
    mcp_servers=[
        {
            "type": "url",
            "name": "database-server",
            "url": "https://mcp-db.example.com"
        }
    ],
    tools=[
        {
            "type": "tool_search_tool_bm25_20251119",
            "name": "tool_search_tool_bm25"
        },
        {
            "type": "mcp_toolset",
            "mcp_server_name": "database-server",
            "default_config": {
                "defer_loading": True
            },
            "configs": {
                "search_events": {  # æœ€é »ä½¿ç”¨ã¯éé…å»¶
                    "defer_loading": False
                }
            }
        }
    ],
    messages=[{
        "role": "user",
        "content": "æœ€æ–°ã®ã‚¤ãƒ™ãƒ³ãƒˆæƒ…å ±ã‚’æ¤œç´¢ã—ã¦ãã ã•ã„"
    }]
)
```

### Phase 4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ»ã‚¬ã‚¤ãƒ‰ä½œæˆ
**ç›®æ¨™**: å®Ÿè£…ã‚¬ã‚¤ãƒ‰ã¨ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹æ–‡æ›¸åŒ–

| ã‚¿ã‚¹ã‚¯ID | å†…å®¹ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | å®Œäº†æ¡ä»¶ | çŠ¶æ…‹ |
|----------|------|-------------|---------|------|
| TASK-021 | Tool Search Tool å°å…¥ã‚¬ã‚¤ãƒ‰ä½œæˆ | `docs/tool-search-implementation.md` | API ä»•æ§˜ãƒ»å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³ãƒ»ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚° | [ ] |
| TASK-022 | å®Ÿè£…ä¾‹é›†ä½œæˆ | `docs/tool-search-examples.md` | Regex / BM25 / MCP çµ±åˆ ä¾‹ | [ ] |
| TASK-023 | æ—¢å­˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ›´æ–° | `.claude/agents/` | å¿…è¦ã«å¿œã˜ã¦ Tool Search Tool ã®æ´»ç”¨æ–¹æ³•è¿½åŠ  | [ ] |

### Phase 5: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãƒ»æœ¬ç•ªåŒ–
**ç›®æ¨™**: ã‚³ã‚¹ãƒˆãƒ»ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã®æœ€é©åŒ–ã¨æœ¬ç•ªé‹ç”¨

| ã‚¿ã‚¹ã‚¯ID | å†…å®¹ | å¯¾è±¡ãƒ•ã‚¡ã‚¤ãƒ« | å®Œäº†æ¡ä»¶ | çŠ¶æ…‹ |
|----------|------|-------------|---------|------|
| TASK-025 | ãƒˆãƒ¼ã‚¯ãƒ³ä½¿ç”¨é‡ã®æœ€é©åŒ– | - | å¾“æ¥æ–¹å¼æ¯”ã§ 20-30% å‰Šæ¸›ã‚’é”æˆ | [ ] |
| TASK-026 | Prompt Caching åŠ¹æœæ¸¬å®š | `tests/cache-performance.md` | ã‚­ãƒ£ãƒƒã‚·ãƒ¥ ON/OFF ã§ãƒˆãƒ¼ã‚¯ãƒ³/é…å»¶ã‚’æ¯”è¼ƒæ¸¬å®š | [ ] |
| TASK-027 | ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¤œè¨¼ | - | ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ24æ™‚é–“TTLï¼‰ã®åŠ¹æœæ¸¬å®š | [ ] |
| TASK-028 | ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°ãƒ»ãƒãƒƒãƒå‡¦ç†ã®æ¤œè¨ | - | Prompt Caching / Batch API ã¨ã®çµ„ã¿åˆã‚ã›æ¤œè¨ | [ ] |
| TASK-029 | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®ç¶²ç¾…çš„ãƒ†ã‚¹ãƒˆ | - | 400/200 ã‚¨ãƒ©ãƒ¼ã®ã™ã¹ã¦ã®ãƒ‘ã‚¿ãƒ¼ãƒ³ã‚’ã‚«ãƒãƒ¼ | [ ] |
| TASK-030 | æœ¬ç•ªå±•é–‹å‰ã®æœ€çµ‚ãƒ†ã‚¹ãƒˆ | - | å…¨æ©Ÿèƒ½ã®çµ±åˆãƒ†ã‚¹ãƒˆå®Ÿæ–½ | [ ] |

## 6. ãƒ†ã‚¹ãƒˆè¨ˆç”»

**è£œè¶³**: TEST-001/002 ã¯ data/tool-search-gold.jsonl ã®è©²å½“ã‚µãƒ–ã‚»ãƒƒãƒˆã‚’ä½¿ç”¨ã€‚å„ãƒ†ã‚¹ãƒˆã‚±ãƒ¼ã‚¹ã« id, query, tool_count, expected_tools ãŒå«ã¾ã‚Œã‚‹ã€‚TEST-003 ã¯çµ±åˆãƒ†ã‚¹ãƒˆã®ãŸã‚ã€ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚ºã¯ TEST-001/002 ã‚ˆã‚Šå°ã•ãã¦ã‚‚å¯ã€‚

| ãƒ†ã‚¹ãƒˆID | ç¨®åˆ¥ | å†…å®¹ | ã‚µãƒ³ãƒ—ãƒ«ã‚µã‚¤ã‚º | æœŸå¾…çµæœï¼ˆå®šé‡çš„ï¼‰ | è¦³æ¸¬æ–¹æ³• |
|----------|------|------|--------------|-------------------|---------|
| TEST-001 | å˜ä½“ | Regex ãƒãƒªã‚¢ãƒ³ãƒˆæ¤œç´¢ç²¾åº¦ | 30ä»¶ | é©åˆç‡ >= 90%, å†ç¾ç‡ >= 85% | gold.jsonl ã® Regex ã‚¯ã‚¨ãƒª subset ã§è©•ä¾¡ |
| TEST-002 | å˜ä½“ | BM25 ãƒãƒªã‚¢ãƒ³ãƒˆæ¤œç´¢ç²¾åº¦ | 30ä»¶ | é©åˆç‡ >= 90%, å†ç¾ç‡ >= 85% | gold.jsonl ã®è‡ªç„¶è¨€èªã‚¯ã‚¨ãƒªã§è©•ä¾¡ |
| TEST-003 | çµ±åˆ | è¤‡æ•°ãƒ„ãƒ¼ãƒ«æ¤œç´¢ã‚·ãƒŠãƒªã‚ª | 20ä»¶ | 3-5 å€‹ã®ãƒ„ãƒ¼ãƒ«å‚ç…§ãŒè¿”å´ã€p95é…å»¶ <= 1.5s | ãƒ¬ã‚¹ãƒãƒ³ã‚¹è¨ˆæ¸¬ãƒ»ãƒ­ã‚°ç¢ºèª |
| TEST-004 | çµ±åˆ | MCP çµ±åˆ | MCP ãƒ„ãƒ¼ãƒ«ãŒæ­£ã—ãé…å»¶èª­ã¿è¾¼ã¿ã€ã‚¨ãƒ©ãƒ¼ç‡ < 5% | server_tool_use ãƒ–ãƒ­ãƒƒã‚¯ç¢ºèª |
| TEST-005 | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»æ¯”è¼ƒ | å¾“æ¥æ–¹å¼æ¯”ã§ 20-30% å‰Šæ¸› | usage ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰æ¯”è¼ƒ |
| TEST-006 | ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶æ¸¬å®š | p95 <= 1.5s, p99 <= 3.0s | 100ãƒªã‚¯ã‚¨ã‚¹ãƒˆã®é…å»¶åˆ†å¸ƒæ¸¬å®š |
| TEST-007 | ã‚¨ãƒ©ãƒ¼å‡¦ç† | 400 ã‚¨ãƒ©ãƒ¼å‡¦ç† | ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«å®šç¾©ãŒå‚™ã‚ã£ã¦ã„ã‚‹ç¢ºèª | ã‚¨ãƒ©ãƒ¼ãƒ¬ã‚¹ãƒãƒ³ã‚¹æ¤œè¨¼ |
| TEST-008 | ã‚¨ãƒ©ãƒ¼å‡¦ç† | ãƒ‘ã‚¿ãƒ¼ãƒ³é•·è¶…é | 200 status ã§ error_code ãŒè¿”å´ | é•·å¤§ãƒ‘ã‚¿ãƒ¼ãƒ³ã§ã®ãƒ†ã‚¹ãƒˆ |
| TEST-009 | ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚° | streaming å¯¾å¿œ | server_tool_use ã‚¤ãƒ™ãƒ³ãƒˆãŒã‚¹ãƒˆãƒªãƒ¼ãƒ å‡ºåŠ› | ã‚¹ãƒˆãƒªãƒ¼ãƒŸãƒ³ã‚°ã‚¤ãƒ™ãƒ³ãƒˆç¢ºèª |
| TEST-010 | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ | ãƒ™ãƒ¼ã‚¿åœæ­¢ã‚·ãƒŸãƒ¥ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ | é™çš„ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã¸è‡ªå‹•åˆ‡æ›¿ã€ã‚¨ãƒ©ãƒ¼ç‡ < 10% | ãƒ¢ãƒƒã‚¯ã‚¨ãƒ©ãƒ¼ã§ã®å‹•ä½œç¢ºèª |

## 7. æˆåŠŸåŸºæº–

### å®šé‡çš„åŸºæº–
- [ ] Tool Search Tool ã§ 10+ å€‹ã®ãƒ„ãƒ¼ãƒ«ç®¡ç†ãŒå¯èƒ½ï¼ˆMCPçµ±åˆæ™‚ã¯50+ï¼‰
- [ ] ãƒˆãƒ¼ã‚¯ãƒ³æ¶ˆè²»ãŒå¾“æ¥æ–¹å¼æ¯” 20-30% å‰Šæ¸›ï¼ˆSCENARIO-002/003 ã§é”æˆï¼‰
- [ ] p95 ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶ <= 1.5ç§’ã€p99 <= 3.0ç§’
- [ ] ãƒ„ãƒ¼ãƒ«é¸æŠé©åˆç‡ >= 90%, å†ç¾ç‡ >= 85%
- [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¶²ç¾…ç‡ 100%ï¼ˆTEST-007/008/010 ã§ã‚«ãƒãƒ¼ï¼‰
- [ ] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆåŠŸç‡ >= 90%ï¼ˆãƒ™ãƒ¼ã‚¿åœæ­¢æ™‚ï¼‰

### å®šæ€§çš„åŸºæº–
- [ ] ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå®Œæ•´åº¦ 90% ä»¥ä¸Šï¼ˆå®Ÿè£…ã‚¬ã‚¤ãƒ‰ã€ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼å«ã‚€ï¼‰
- [ ] å®Ÿè£…ä¾‹æ•° 3+ ãƒ‘ã‚¿ãƒ¼ãƒ³ï¼ˆRegex, BM25, MCPçµ±åˆï¼‰
- [ ] éé…å»¶ãƒ„ãƒ¼ãƒ«é¸å®šãƒ—ãƒ­ã‚»ã‚¹ãŒæ–‡æ›¸åŒ–ã•ã‚Œé‹ç”¨å¯èƒ½
- [ ] ãƒãƒ¼ãƒ ãƒ¡ãƒ³ãƒãƒ¼å…¨å“¡ãŒä½¿ç”¨æ–¹æ³•ã‚’ç†è§£

## 8. ãƒªã‚¹ã‚¯ã¨å¯¾ç­–

| ID | ãƒªã‚¹ã‚¯ | å½±éŸ¿åº¦ | å¯¾ç­– | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥ |
|----|--------|--------|------|------------------|
| RISK-001 | ãƒ™ãƒ¼ã‚¿æ©Ÿèƒ½ã®ãŸã‚ä»•æ§˜å¤‰æ›´ | ä¸­ | å®šæœŸçš„ã«å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç¢ºèªã€SDK ãƒãƒ¼ã‚¸ãƒ§ãƒ³ãƒ”ãƒ³ç•™ã‚ | å¾“æ¥æ–¹å¼ã¸ã®å³åº§åˆ‡æ›¿ |
| RISK-002 | Haiku ãƒ¢ãƒ‡ãƒ«ã§ä½¿ç”¨ä¸å¯ | ä½ | ä½¿ç”¨ãƒ¢ãƒ‡ãƒ«ã‚’åˆ¶é™(Opus/Sonnet ã®ã¿) | - |
| RISK-003 | tool_choice ã¨ã®ä½µç”¨ä¸å¯ | ä¸­ | ä»£æ›¿å®Ÿè£…æ–¹æ³•ã‚’æ¤œè¨(ã‚«ã‚¹ã‚¿ãƒ ãƒ„ãƒ¼ãƒ«æ¤œç´¢) | é™çš„ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆ + tool_choice ä½¿ç”¨ |
| RISK-004 | ã™ã¹ã¦ã®ãƒ„ãƒ¼ãƒ«å®šç¾©å¿…é ˆ | ä¸­ | ãƒ„ãƒ¼ãƒ«å‚ç…§ã‚¹ã‚¯ãƒªãƒ—ãƒˆè‡ªå‹•åŒ– | ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚­ãƒ£ãƒƒã‚·ãƒ¥åˆ©ç”¨ |
| RISK-005 | ãƒ¬ãƒ¼ãƒˆåˆ¶é™(too_many_requests) | ä½ | æ¤œç´¢ãƒªãƒˆãƒ©ã‚¤ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…ï¼ˆexponential backoffï¼‰ | é™çš„ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã¸ä¸€æ™‚åˆ‡æ›¿ |
| RISK-006 | ãƒ™ãƒ¼ã‚¿æ©Ÿèƒ½ã®çªç„¶ã®åœæ­¢ | é«˜ | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ãƒ­ã‚¸ãƒƒã‚¯å®Ÿè£…ï¼ˆTASK-010/015ï¼‰ | é™çš„ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆ + ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°è¨˜éŒ² |
| RISK-007 | API ã‚­ãƒ¼æ¼æ´©ãƒªã‚¹ã‚¯ | é«˜ | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ç­–å®šï¼ˆTASK-011ï¼‰ã€ç’°å¢ƒå¤‰æ•°ç®¡ç† | API ã‚­ãƒ¼ç„¡åŠ¹åŒ–ãƒ»å†ç™ºè¡Œæ‰‹é †æ•´å‚™ |

### ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥è©³ç´°

**ãƒ¬ãƒ™ãƒ«1: ãƒªãƒˆãƒ©ã‚¤**
- Tool Search Tool ã‚¨ãƒ©ãƒ¼æ™‚ã€3å›ã¾ã§ãƒªãƒˆãƒ©ã‚¤ï¼ˆexponential backoffï¼‰
- ã‚¿ã‚¤ãƒ ã‚¢ã‚¦ãƒˆ: åˆå›5ç§’ã€2å›ç›®10ç§’ã€3å›ç›®20ç§’

**ãƒ¬ãƒ™ãƒ«2: é™çš„ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã¸ã®åˆ‡æ›¿**
- ãƒªãƒˆãƒ©ã‚¤å¤±æ•—æ™‚ã€äº‹å‰å®šç¾©ã®é™çš„ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆï¼ˆæœ€é »ä½¿ç”¨3-5å€‹ï¼‰ã‚’ä½¿ç”¨
- ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã‚’è¨˜éŒ²ã—ã€ç›£è¦–ã‚¢ãƒ©ãƒ¼ãƒˆç™ºç«

**ãƒ¬ãƒ™ãƒ«3: å¾“æ¥æ–¹å¼ã¸ã®å®Œå…¨åˆ‡æ›¿**
- ãƒ™ãƒ¼ã‚¿æ©Ÿèƒ½åœæ­¢ãŒæ¤œå‡ºã•ã‚ŒãŸå ´åˆã€å…¨ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’é€ä¿¡ã™ã‚‹å¾“æ¥æ–¹å¼ã¸åˆ‡æ›¿
- è¨­å®šãƒ•ã‚¡ã‚¤ãƒ«ã§ã®ãƒ•ãƒ©ã‚°ç®¡ç†: `USE_TOOL_SEARCH=false`

**ã‚­ãƒ£ãƒƒã‚·ãƒ³ã‚°æˆ¦ç•¥**
- ãƒ„ãƒ¼ãƒ«å®šç¾©ã‚’ãƒ­ãƒ¼ã‚«ãƒ«ã‚­ãƒ£ãƒƒã‚·ãƒ¥ï¼ˆ24æ™‚é–“TTLï¼‰
- Prompt Caching ã‚’ä½µç”¨ã—ã¦ã‚³ã‚¹ãƒˆå‰Šæ¸›

### é‹ç”¨ç›£è¦–ã¨ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™ºç«æ¡ä»¶

#### ç›£è¦–ãƒ¡ãƒˆãƒªã‚¯ã‚¹ã¨é–¾å€¤

| ãƒ¡ãƒˆãƒªã‚¯ã‚¹ | ç›£è¦–æ–¹æ³• | è­¦å‘Šé–¾å€¤ | åˆ‡æ›¿é–¾å€¤ | æ¸¬å®šé–“éš” |
|-----------|---------|---------|---------|---------|
| ã‚¨ãƒ©ãƒ¼ç‡ | APIå¿œç­”ã®ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ã‚³ãƒ¼ãƒ‰é›†è¨ˆ | >= 3% | >= 5% | 5åˆ†ã”ã¨ |
| p95 ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶ | APIå‘¼ã³å‡ºã—æ™‚é–“ã®95ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« | >= 1.2ç§’ | >= 1.5ç§’ | 5åˆ†ã”ã¨ |
| p99 ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶ | APIå‘¼ã³å‡ºã—æ™‚é–“ã®99ãƒ‘ãƒ¼ã‚»ãƒ³ã‚¿ã‚¤ãƒ« | >= 2.5ç§’ | >= 3.0ç§’ | 5åˆ†ã”ã¨ |
| API rate limitæ®‹é‡ | ãƒ¬ã‚¹ãƒãƒ³ã‚¹ãƒ˜ãƒƒãƒ€ãƒ¼ `x-ratelimit-remaining` | < 20% | < 10% | ãƒªã‚¯ã‚¨ã‚¹ãƒˆã”ã¨ |
| Tool Searchå¤±æ•—ç‡ | `server_tool_use`ã®å¤±æ•—å›æ•° / ç·ãƒªã‚¯ã‚¨ã‚¹ãƒˆ | >= 8% | >= 10% | 5åˆ†ã”ã¨ |

#### ã‚¨ã‚¹ã‚«ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³ãƒ•ãƒ­ãƒ¼

```
1. è­¦å‘Šé–¾å€¤è¶…é
   â†’ ãƒ­ã‚°è¨˜éŒ² + Slacké€šçŸ¥ï¼ˆ#alerts ãƒãƒ£ãƒãƒ«ï¼‰
   â†’ ç¶™ç¶šç›£è¦–ï¼ˆ1åˆ†é–“éš”ã«çŸ­ç¸®ï¼‰

2. åˆ‡æ›¿é–¾å€¤è¶…éï¼ˆ10åˆ†é–“ç¶™ç¶šï¼‰
   â†’ ãƒ¬ãƒ™ãƒ«2ã¸è‡ªå‹•åˆ‡æ›¿ï¼ˆé™çš„ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆï¼‰
   â†’ Slacké€šçŸ¥ + PagerDuty ã‚¢ãƒ©ãƒ¼ãƒˆ
   â†’ æ‹…å½“è€…: ã‚ªãƒ³ã‚³ãƒ¼ãƒ«ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢

3. é™çš„ãƒ„ãƒ¼ãƒ«ã‚»ãƒƒãƒˆã§ã‚‚ã‚¨ãƒ©ãƒ¼ç‡ >= 10%
   â†’ ãƒ¬ãƒ™ãƒ«3ã¸è‡ªå‹•åˆ‡æ›¿ï¼ˆå¾“æ¥æ–¹å¼ï¼‰
   â†’ Slacké€šçŸ¥ + PagerDuty ç·Šæ€¥ã‚¢ãƒ©ãƒ¼ãƒˆ
   â†’ æ‹…å½“è€…: ã‚·ãƒ‹ã‚¢ã‚¨ãƒ³ã‚¸ãƒ‹ã‚¢ + ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆãƒãƒãƒ¼ã‚¸ãƒ£ãƒ¼
```

#### é‹ç”¨ãƒã‚§ãƒƒã‚¯ãƒªã‚¹ãƒˆ

**æ—¥æ¬¡ãƒã‚§ãƒƒã‚¯ï¼ˆè‡ªå‹•åŒ–ï¼‰:**
- [ ] Tool Search Tool ã®ä½¿ç”¨çŠ¶æ³ãƒ¬ãƒãƒ¼ãƒˆç¢ºèªï¼ˆãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›ç‡ã€ã‚¨ãƒ©ãƒ¼ç‡ï¼‰
- [ ] ã‚¨ãƒ©ãƒ¼ãƒ­ã‚°ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ï¼ˆERROR ãƒ¬ãƒ™ãƒ«ä»¥ä¸Šï¼‰
- [ ] p95/p99 é…å»¶ãƒˆãƒ¬ãƒ³ãƒ‰ã®ç¢ºèª
- [ ] logs/api-calls.jsonl ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ç¢ºèªï¼ˆ30æ—¥è¶…éåˆ†ã¯å‰Šé™¤ï¼‰
- [ ] ãƒ­ã‚°ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç›£è¦–ï¼ˆç•°å¸¸å¢—æ®–ã®æ¤œå‡ºï¼‰

**é€±æ¬¡ãƒã‚§ãƒƒã‚¯ï¼ˆæ‰‹å‹•ï¼‰:**
- [ ] éé…å»¶ãƒ„ãƒ¼ãƒ«é¸å®šã®å¦¥å½“æ€§ç¢ºèªï¼ˆä½¿ç”¨é »åº¦ãƒ¬ãƒãƒ¼ãƒˆï¼‰
- [ ] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯ç™ºç«å±¥æ­´ã®ãƒ¬ãƒ“ãƒ¥ãƒ¼
- [ ] ãƒ™ãƒ¼ã‚¿æ©Ÿèƒ½ã®å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆæ›´æ–°ç¢ºèª

**æœˆæ¬¡ãƒã‚§ãƒƒã‚¯ï¼ˆæ‰‹å‹•ï¼‰:**
- [ ] scripts/analyze-tool-usage.py ã‚’å®Ÿè¡Œ
- [ ] æ¨å¥¨éé…å»¶ãƒ„ãƒ¼ãƒ«ã‚’ç¢ºèª
- [ ] å‰æœˆæ¯”ã§å¤‰åŒ–ãŒã‚ã‚‹ã‹ç¢ºèªï¼ˆå¤‰åŒ– > 20% ãªã‚‰æ›´æ–°æ¤œè¨ï¼‰
- [ ] éé…å»¶ãƒ„ãƒ¼ãƒ«ã®è¦‹ç›´ã—ã¨æ›´æ–°
- [ ] ã‚³ã‚¹ãƒˆåˆ†æãƒ¬ãƒãƒ¼ãƒˆä½œæˆï¼ˆTool Search vs å¾“æ¥æ–¹å¼ï¼‰
- [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»ï¼ˆAPI ã‚­ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ã€ã‚¢ã‚¯ã‚»ã‚¹ãƒ­ã‚°ï¼‰

**å››åŠæœŸãƒã‚§ãƒƒã‚¯ï¼ˆæ‰‹å‹•ï¼‰:**
- [ ] ã‚´ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã®ãƒ¬ãƒ“ãƒ¥ãƒ¼ã¨æ›´æ–°
- [ ] SDK ãƒãƒ¼ã‚¸ãƒ§ãƒ³ã‚¢ãƒƒãƒ—ã‚°ãƒ¬ãƒ¼ãƒ‰ã®æ¤œè¨
- [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ãƒ™ãƒ³ãƒãƒãƒ¼ã‚¯ã®å†å®Ÿè¡Œ

**åˆ‡æ›¿å¾Œã®å¾©æ—§æ‰‹é †:**
1. æ ¹æœ¬åŸå› ã®ç‰¹å®šï¼ˆãƒ­ã‚°åˆ†æã€API ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹ç¢ºèªï¼‰
2. å•é¡Œè§£æ±ºã®ç¢ºèªï¼ˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œï¼‰
3. æ®µéšçš„ãªå¾©å¸°ï¼ˆ10% â†’ 50% â†’ 100% ã®ãƒˆãƒ©ãƒ•ã‚£ãƒƒã‚¯ï¼‰
4. 24æ™‚é–“ã®ç›£è¦–å¼·åŒ–

### ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒ»ç§˜å¯†æƒ…å ±ç®¡ç†

**API ã‚­ãƒ¼ç®¡ç†:**
- ç’°å¢ƒå¤‰æ•°çµŒç”±ã§ã®ã¿å–å¾—ï¼ˆ`ANTHROPIC_API_KEY`ï¼‰
- `.env` ãƒ•ã‚¡ã‚¤ãƒ«ã¯ `.gitignore` ã«è¿½åŠ 
- CI/CD ã§ã¯ã‚·ãƒ¼ã‚¯ãƒ¬ãƒƒãƒˆç®¡ç†æ©Ÿèƒ½ã‚’ä½¿ç”¨ï¼ˆGitHub Secrets, AWS Secrets Managerç­‰ï¼‰

**ãƒ­ã‚°ç®¡ç†:**
- API ã‚­ãƒ¼ã‚’ãƒ­ã‚°ã«å‡ºåŠ›ã—ãªã„ï¼ˆãƒã‚¹ã‚­ãƒ³ã‚°å‡¦ç†ï¼‰
- ãƒ¦ãƒ¼ã‚¶ãƒ¼å…¥åŠ›ã«å«ã¾ã‚Œã‚‹å¯èƒ½æ€§ã®ã‚ã‚‹ç§˜å¯†æƒ…å ±ã‚‚ãƒã‚¹ã‚­ãƒ³ã‚°
- ãƒ­ã‚°ãƒ¬ãƒ™ãƒ«: æœ¬ç•ªç’°å¢ƒã§ã¯ INFO ä»¥ä¸Šã€é–‹ç™ºç’°å¢ƒã§ã¯ DEBUG å¯

**æ¨©é™ç®¡ç†:**
- æœ€å°æ¨©é™ã®åŸå‰‡ï¼ˆLeast Privilegeï¼‰ã‚’é©ç”¨
- API ã‚­ãƒ¼ã®ã‚¹ã‚³ãƒ¼ãƒ—ã‚’å¿…è¦æœ€å°é™ã«åˆ¶é™
- å®šæœŸçš„ãªã‚­ãƒ¼ãƒ­ãƒ¼ãƒ†ãƒ¼ã‚·ãƒ§ãƒ³ï¼ˆå››åŠæœŸã«1å›ï¼‰

## 9. ä¾å­˜é–¢ä¿‚

```
Phase 1: åŸºæœ¬æ¤œè¨¼ãƒ»æ¸¬å®šè¨­è¨ˆï¼ˆä¿®æ­£ç‰ˆï¼‰

â”Œâ”€ TASK-001 (ãƒ™ãƒ¼ã‚¿ä»•æ§˜ç¢ºèª) â”€â”
â”‚                              â”œâ”€ TASK-004 (SDKç¢ºèª)
â”‚                              â”‚
â””â”€ TASK-002 (ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ) â”€â”€â”€â”€â”˜

â”Œâ”€ TASK-003 (ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ) â”€â”€â”€â”€â”¬â”€ TASK-005 (ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³) â”€â”€â”
â”‚                             â”‚                              â”‚
â”‚                             â””â”€ TASK-007 (Regex) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€ TASK-009 (æ¸¬å®š)
â”‚                                                           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€ TASK-008 (BM25) â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                                                            â”‚
                                                  TASK-010 (ã‚¨ãƒ©ãƒ¼æ¤œè¨¼)

TASK-006 (ãƒ„ãƒ¼ãƒ«ä½¿ç”¨é »åº¦) ã¯ä¸¦è¡Œå®Ÿè¡Œå¯èƒ½
    â†“
Phase 2: Agent SDK çµ±åˆãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­è¨ˆ
    â”œâ”€ TASK-012 (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­è¨ˆ) â”€â”€â” [ä¸¦è¡Œå®Ÿè¡Œå¯èƒ½]
    â””â”€ TASK-013 (ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£æ–¹é‡)  â”€â”€â”€â”˜
    â†“
    TASK-011 (SDK ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«) â†’ TASK-014/015/016 (çµ±åˆãƒ†ã‚¹ãƒˆ) â†’ TASK-017 (ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…)
    â†“
Phase 3: MCP çµ±åˆ â† Phase 1,2 å®Œäº†å¾Œ
    TASK-018 â†’ TASK-019 â†’ TASK-020 (é †æ¬¡å®Ÿè¡Œ)
    â†“
Phase 4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ â† Phase 1-3 ã®çŸ¥è¦‹ã‚’åæ˜ 
    TASK-021/022/023 [ä¸¦è¡Œå®Ÿè¡Œå¯èƒ½]
    â†“
Phase 5: æœ¬ç•ªåŒ– â† Phase 1-4 å®Œäº†å¾Œ
    TASK-025 â†’ TASK-026/027/028 (ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¤œè¨¼ä¸¦è¡Œå¯) â†’ TASK-029 â†’ TASK-030
```

**ä¸¦è¡Œå®Ÿè¡Œå¯èƒ½ãªã‚¿ã‚¹ã‚¯:**
- Phase 1: TASK-001, 002, 003, 004, 005, 006 (6ã‚¿ã‚¹ã‚¯åŒæ™‚å®Ÿè¡Œå¯)
- Phase 2: TASK-012, 013 (2ã‚¿ã‚¹ã‚¯åŒæ™‚å®Ÿè¡Œå¯)
- Phase 4: TASK-021, 022, 023 (3ã‚¿ã‚¹ã‚¯åŒæ™‚å®Ÿè¡Œå¯)
- Phase 5: TASK-026, 027, 028 (ã‚­ãƒ£ãƒƒã‚·ãƒ¥æ¤œè¨¼3ã‚¿ã‚¹ã‚¯åŒæ™‚å®Ÿè¡Œå¯)

## 10. å°å…¥å¾Œã®æœŸå¾…åŠ¹æœ

### ã‚³ã‚¹ãƒˆå‰Šæ¸›
- ãƒ„ãƒ¼ãƒ«å®šç¾©ãƒˆãƒ¼ã‚¯ãƒ³: 50ãƒ„ãƒ¼ãƒ«æ™‚ 10-20K å‰Šæ¸›ï¼ˆæ¸¬å®šã«ã‚ˆã‚Šæ¤œè¨¼ï¼‰
- æœˆé–“ API ã‚³ã‚¹ãƒˆå‰Šæ¸›: ç´„ 10-15%ï¼ˆãƒˆãƒ¼ã‚¯ãƒ³å‰Šæ¸›ç‡ 20-30% ã‚’é”æˆã—ãŸå ´åˆï¼‰
- Prompt Caching ã¨ã®ä½µç”¨ã§æ›´ãªã‚‹ã‚³ã‚¹ãƒˆå‰Šæ¸›ï¼ˆæœ€å¤§ 50%ï¼‰

### ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹å‘ä¸Š
- ãƒ„ãƒ¼ãƒ«é¸æŠç²¾åº¦: 30-50+ ãƒ„ãƒ¼ãƒ«ã§ä½ä¸‹ãªã—ï¼ˆé©åˆç‡ >= 90%ï¼‰
- ã‚³ãƒ³ãƒ†ã‚­ã‚¹ãƒˆçª“ã®æœ‰åŠ¹æ´»ç”¨: å®Ÿå‹™ãƒ­ã‚¸ãƒƒã‚¯ã«å……å½“å¯èƒ½ãªãƒˆãƒ¼ã‚¯ãƒ³å¢—åŠ 
- ãƒ¬ã‚¹ãƒãƒ³ã‚¹é…å»¶: p95 <= 1.5ç§’ã‚’ç¶­æŒ

### æ‹¡å¼µæ€§
- ãƒ„ãƒ¼ãƒ«æ•°åˆ¶é™: 10,000 ã¾ã§ç®¡ç†å¯èƒ½ï¼ˆç†è«–å€¤ï¼‰
- ãƒãƒ«ãƒãƒ‰ãƒ¡ã‚¤ãƒ³å¯¾å¿œ: è¤‡æ•°é ˜åŸŸã®å°‚é–€ãƒ„ãƒ¼ãƒ«çµ±åˆï¼ˆMCPçµ±åˆã«ã‚ˆã‚Šå®Ÿç¾ï¼‰

### é‹ç”¨ãƒ»ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£
- ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æ©Ÿèƒ½ã«ã‚ˆã‚Šå¯ç”¨æ€§ >= 90% ã‚’ç¶­æŒ
- API ã‚­ãƒ¼ç®¡ç†ãƒ»ãƒ­ã‚°é™¤å¤–ã«ã‚ˆã‚Šç§˜å¯†æƒ…å ±æ¼æ´©ãƒªã‚¹ã‚¯ã‚’æœ€å°åŒ–
- éé…å»¶ãƒ„ãƒ¼ãƒ«é¸å®šãƒ—ãƒ­ã‚»ã‚¹ã«ã‚ˆã‚Šç¶™ç¶šçš„ãªæœ€é©åŒ–

## 11. æ¬¡ã®ã‚¢ã‚¯ã‚·ãƒ§ãƒ³

âš ï¸ **è¨ˆç”»é–‹å§‹å‰ã®å¿…é ˆã‚¿ã‚¹ã‚¯**: TASK-001ï¼ˆãƒ™ãƒ¼ã‚¿ä»•æ§˜ç¢ºèªï¼‰ã‚’å®Œäº†ã—ã€`docs/beta-spec-verification.md` ã«è¨˜éŒ²ã™ã‚‹ã¾ã§å®Ÿè£…ä¾‹ã®å®Ÿè¡Œã¯ä¸å¯ã€‚

### å³æ™‚(ä»Šé€±ä¸­)
1. [ ] ğŸ”´ **æœ€å„ªå…ˆ**: ãƒ™ãƒ¼ã‚¿ç‰ˆä»•æ§˜ã®æœ€æ–°ç‰ˆç¢ºèªï¼ˆTASK-001ï¼‰
2. [ ] å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆç²¾èª­ï¼ˆTASK-002ï¼‰
3. [ ] è©•ä¾¡ç”¨ã‚´ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆä½œæˆï¼ˆTASK-003ï¼‰
4. [ ] SDK ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç¢ºèªãƒ»ãƒ”ãƒ³ç•™ã‚ï¼ˆTASK-004ï¼‰
5. [ ] ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆä½œæˆï¼ˆTASK-005ï¼‰
6. [ ] Regex/BM25 ä¸¡ãƒãƒªã‚¢ãƒ³ãƒˆå®Ÿè£…ä¾‹ãƒ†ã‚¹ãƒˆï¼ˆTASK-007/008ï¼‰

### çŸ­æœŸ(æ¥é€±)
1. [ ] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥è¨­è¨ˆï¼ˆTASK-012ï¼‰
2. [ ] ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ç­–å®šï¼ˆTASK-013ï¼‰
3. [ ] Agent SDK ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ï¼ˆTASK-011ï¼‰
4. [ ] çµ±åˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè£…ï¼ˆTASK-014ï¼‰
5. [ ] MCP ã‚µãƒ¼ãƒãƒ¼ã¨ã®çµ±åˆãƒ†ã‚¹ãƒˆï¼ˆTASK-015ï¼‰

### ä¸­æœŸ(2é€±é–“)
1. [ ] MCP ãƒ„ãƒ¼ãƒ«ã®é…å»¶è¨­å®šï¼ˆTASK-019ï¼‰
2. [ ] ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯å®Ÿè£…ãƒ»ãƒ†ã‚¹ãƒˆï¼ˆTASK-017ï¼‰
3. [ ] å°å…¥ã‚¬ã‚¤ãƒ‰ä½œæˆï¼ˆTASK-021/022/023ï¼‰

### é•·æœŸ(3-4é€±é–“)
1. [ ] ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ï¼ˆTASK-025ï¼‰
2. [ ] Prompt Caching åŠ¹æœæ¸¬å®šï¼ˆTASK-026/027/028ï¼‰
3. [ ] ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ç¶²ç¾…çš„ãƒ†ã‚¹ãƒˆï¼ˆTASK-029ï¼‰
4. [ ] æœ¬ç•ªç’°å¢ƒãƒ‡ãƒ—ãƒ­ã‚¤ï¼ˆTASK-030ï¼‰

---

## 12. æˆæœç‰©ã®é…ç½®ãƒãƒªã‚·ãƒ¼

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå…¨ä½“ã§ä¸€è²«æ€§ã®ã‚ã‚‹ãƒ•ã‚¡ã‚¤ãƒ«é…ç½®ã‚’ç¶­æŒã™ã‚‹ãŸã‚ã€ä»¥ä¸‹ã®ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªæ§‹æˆã¨å‘½åè¦å‰‡ã«å¾“ã„ã¾ã™ã€‚

| ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒª | é…ç½®å¯¾è±¡ | å‘½åè¦å‰‡ | ä¾‹ |
|------------|---------|---------|-----|
| `data/` | è©•ä¾¡ç”¨ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ | `{ç”¨é€”}-{å½¢å¼}.{æ‹¡å¼µå­}` | `tool-search-gold.jsonl` |
| `scripts/` | è¨ˆæ¸¬ãƒ»åˆ†æã‚¹ã‚¯ãƒªãƒ—ãƒˆ | `{å‹•è©}-{å¯¾è±¡}.py` | `measure-performance.py` |
| `examples/` | å®Ÿè£…ã‚µãƒ³ãƒ—ãƒ« | `tool-search-{æ©Ÿèƒ½}-{è¨€èª}.{æ‹¡å¼µå­}` | `tool-search-basic-regex.py` |
| `agents/` | ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆå®Ÿè£… | `{æ©Ÿèƒ½å}.py` | `advanced-tool-search.py` |
| `docs/` | ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | `{å¯¾è±¡}-{ç¨®åˆ¥}.md` | `tool-search-implementation.md` |
| `tests/` | ãƒ†ã‚¹ãƒˆçµæœãƒ»ãƒ¬ãƒãƒ¼ãƒˆ | `{å¯¾è±¡}-test.md` | `mcp-integration-test.md` |
| `results/` | æ¸¬å®šçµæœ | `{å¯¾è±¡}-YYYYMMDD.{æ‹¡å¼µå­}` | `performance-20251208.csv` |

### æˆæœç‰©ã®æƒ³å®šãƒ‘ã‚¹ä¸€è¦§

å„ã‚¿ã‚¹ã‚¯ã§ä½œæˆã•ã‚Œã‚‹ãƒ•ã‚¡ã‚¤ãƒ«ã®å…·ä½“çš„ãªãƒ‘ã‚¹ã‚’ç¤ºã—ã¾ã™ï¼š

#### Phase 1: åŸºæœ¬æ¤œè¨¼ãƒ»æ¸¬å®šè¨­è¨ˆ

| ã‚¿ã‚¹ã‚¯ID | æˆæœç‰© | æƒ³å®šãƒ‘ã‚¹ |
|----------|--------|---------|
| TASK-001 | ãƒ™ãƒ¼ã‚¿ä»•æ§˜ç¢ºèªçµæœ | `docs/beta-spec-verification.md` |
| TASK-003 | ã‚´ãƒ¼ãƒ«ãƒ‰ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆ | `data/tool-search-gold.jsonl` |
| TASK-005 | ãƒ™ãƒ¼ã‚¹ãƒ©ã‚¤ãƒ³æ¸¬å®šã‚¹ã‚¯ãƒªãƒ—ãƒˆ | `scripts/measure-performance.py` |
| TASK-006 | ãƒ„ãƒ¼ãƒ«ä½¿ç”¨é »åº¦é›†è¨ˆã‚¹ã‚¯ãƒªãƒ—ãƒˆ | `scripts/analyze-tool-usage.py` |
| TASK-007 | Regexå®Ÿè£…ä¾‹ | `examples/tool-search-basic-regex.py` |
| TASK-008 | BM25å®Ÿè£…ä¾‹ | `examples/tool-search-basic-bm25.ts` |
| TASK-009 | æ¸¬å®šçµæœ | `results/performance-20251208.csv` |
| - | ãƒãƒªãƒ‡ãƒ¼ã‚·ãƒ§ãƒ³ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | `scripts/validate-gold-dataset.py` |
| - | GitHub Actions ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼ | `.github/workflows/validate-gold-dataset.yml` |

#### Phase 2: Agent SDK çµ±åˆãƒ»ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯è¨­è¨ˆ

| ã‚¿ã‚¹ã‚¯ID | æˆæœç‰© | æƒ³å®šãƒ‘ã‚¹ |
|----------|--------|---------|
| TASK-012 | ãƒ•ã‚©ãƒ¼ãƒ«ãƒãƒƒã‚¯æˆ¦ç•¥ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ | `docs/fallback-strategy.md` |
| TASK-013 | ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ãƒãƒªã‚·ãƒ¼ | `docs/security-policy.md` |
| TASK-014 | Tool Searchçµ±åˆã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆ | `agents/advanced-tool-search.py` |
| TASK-015 | MCPçµ±åˆãƒ†ã‚¹ãƒˆçµæœ | `tests/mcp-integration-test.md` |

#### Phase 3: MCP çµ±åˆ

| ã‚¿ã‚¹ã‚¯ID | æˆæœç‰© | æƒ³å®šãƒ‘ã‚¹ |
|----------|--------|---------|
| TASK-018 | MCPãƒ„ãƒ¼ãƒ«ä¸€è¦§å–å¾—ã‚¹ã‚¯ãƒªãƒ—ãƒˆ | `scripts/get-mcp-tools.py` |
| TASK-020 | è¤‡æ•°MCPçµ±åˆãƒ†ã‚¹ãƒˆçµæœ | `tests/multi-mcp-integration-test.md` |

#### Phase 4: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆä½œæˆ

| ã‚¿ã‚¹ã‚¯ID | æˆæœç‰© | æƒ³å®šãƒ‘ã‚¹ |
|----------|--------|---------|
| TASK-021 | å°å…¥ã‚¬ã‚¤ãƒ‰ | `docs/tool-search-implementation.md` |
| TASK-022 | å®Ÿè£…ä¾‹é›† | `docs/tool-search-examples.md` |
| TASK-023 | æ—¢å­˜ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆæ›´æ–° | `.claude/agents/` |

#### Phase 5: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ãƒ»æœ¬ç•ªåŒ–

| ã‚¿ã‚¹ã‚¯ID | æˆæœç‰© | æƒ³å®šãƒ‘ã‚¹ |
|----------|--------|---------|
| TASK-026 | Prompt CachingåŠ¹æœæ¸¬å®šçµæœ | `tests/cache-performance.md` |
| TASK-030 | æœ€çµ‚ãƒ†ã‚¹ãƒˆçµæœ | `tests/integration-test-final.md` |

**ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªä½œæˆæ‰‹é †:**
```bash
mkdir -p data scripts examples agents docs tests results
```

**ãƒ•ã‚¡ã‚¤ãƒ«ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹:**
- æ¸¬å®šçµæœã¯æ—¥ä»˜ä»˜ãã§ä¿å­˜ã—ã€7æ—¥ä»¥ä¸ŠçµŒéã—ãŸã‚‚ã®ã¯ `results/archive/` ã«ç§»å‹•
- ãƒ‡ãƒ¼ã‚¿ã‚»ãƒƒãƒˆã¯ãƒãƒ¼ã‚¸ãƒ§ãƒ³ç®¡ç†å¯¾è±¡ã«å«ã‚ã‚‹
- ã‚¹ã‚¯ãƒªãƒ—ãƒˆã«ã¯å®Ÿè¡Œæ¨©é™ã‚’ä»˜ä¸: `chmod +x scripts/*.py`

---

## å‚è€ƒè³‡æ–™

### å…¬å¼ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ
- [Tool Search Tool - Claude API Docs](https://platform.claude.com/docs/en/agents-and-tools/tool-use/tool-search-tool)
- [Tool Use Implementation - Claude API Docs](https://platform.claude.com/docs/en/agents-and-tools/tool-use/implement-tool-use)
- [MCP Integration - Claude API Docs](https://platform.claude.com/docs/en/agents-and-tools/mcp-connector)

### é–¢é€£ãƒªã‚½ãƒ¼ã‚¹
- Anthropic Cookbook: [Tool Search with Embeddings](https://github.com/anthropics/anthropic-cookbook)
- Claude Agent SDK: [Python](https://github.com/anthropics/anthropic-sdk-python) / [TypeScript](https://github.com/anthropics/anthropic-sdk-typescript)

### ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆå†…å‚è€ƒè³‡æ–™
- @docs/claude-code-usage.md
- @docs/claude-code-mcp-setup.md
- @CLAUDE.md

---
*ã“ã®ãƒ—ãƒ©ãƒ³ã¯ Claude Guide Agent ã«ã‚ˆã£ã¦ä½œæˆã•ã‚Œã¾ã—ãŸ*
