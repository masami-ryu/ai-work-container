# CLAUDE.md 更新提案基準

## 目次
- [提案すべきケース](#提案すべきケース)
- [提案すべきでないケース](#提案すべきでないケース)
- [分析観点の詳細](#分析観点の詳細)
- [品質チェックリスト](#品質チェックリスト)

---

## 提案すべきケース

### 1. 新しいワークフローの発見

**提案すべきとき**:
```
チェックリスト:
- [ ] セッション内で繰り返し使用された作業パターンがある
- [ ] そのパターンがCLAUDE.mdに記載されていない
- [ ] 今後も使う可能性が高い（再利用性が高い）
- [ ] 他のメンバーにも有用
```

**例**:
- PRレビュー → レビュー結果保存 → Issue作成の一連の流れ
- プラン作成 → 実装 → テスト → コミットの標準フロー
- スキル開発 → 評価シナリオ作成 → ベースライン記録のサイクル

**提案形式**:
```markdown
### 追加すべき項目
- PRレビューワークフロー: PRレビュー後に ai/reviews/ に結果を保存し、Issue作成する標準フロー
```

---

### 2. 重要なコマンドや設定の抽出

**提案すべきとき**:
```
チェックリスト:
- [ ] セッション内で3回以上使用されたコマンドがある
- [ ] そのコマンドが複雑で覚えにくい
- [ ] プロジェクト固有の設定や引数がある
- [ ] CLAUDE.mdに記載されていない
```

**例**:
- `gh pr create --title "..." --body "$(cat <<'EOF' ... EOF)" --label "..." --assignee "..."`
- `gh issue list --state all --label priority:high --json number,title,state`
- プロジェクト固有の `npm run` コマンド（`npm run test:integration` など）

**提案形式**:
```markdown
### 追加すべき項目
- PRコマンド: `gh pr create` でHEREDOCを使用した長い本文の指定方法
```

---

### 3. プロジェクト構造の変更

**提案すべきとき**:
```
チェックリスト:
- [ ] 新しいディレクトリが追加された
- [ ] そのディレクトリが標準的な保存先として使用される
- [ ] CLAUDE.mdに記載されていない
- [ ] 今後も使い続ける見込み
```

**例**:
- `ai/plans/` ディレクトリの追加（プラン保存先）
- `ai/reviews/` ディレクトリの追加（レビュー結果保存先）
- `.claude/skills/` ディレクトリの構造変更（スキル追加）

**提案形式**:
```markdown
### 追加すべき項目
- ディレクトリ構造: ai/plans/ はプランの保存先、ファイル命名規則は YYMMDD_[概要].md
```

---

### 4. ベストプラクティスの識別

**提案すべきとき**:
```
チェックリスト:
- [ ] セッション内で「良い習慣」として機能した方法がある
- [ ] その方法が品質向上やエラー削減に寄与した
- [ ] CLAUDE.mdに記載されていない
- [ ] 他のタスクにも適用可能
```

**例**:
- コミット前の `git status` と `git diff` の確認
- PR作成前の `git log` による履歴確認
- Issue作成前のチェックリストによる検証

**提案形式**:
```markdown
### 追加すべき項目
- ベストプラクティス: コミット前に必ず git status と git diff を実行し、変更内容を確認する
```

---

### 5. 注意点や落とし穴の発見

**提案すべきとき**:
```
チェックリスト:
- [ ] セッション内でエラーや問題が発生した
- [ ] その問題が再発する可能性がある
- [ ] 回避方法が明確
- [ ] CLAUDE.mdに記載されていない
```

**例**:
- `gh pr create` でラベル名のスペルミスによる失敗
- HEREDOC で `EOF` のクォート忘れによるシェル変数展開の問題
- `git commit --amend` の誤用（プッシュ済みコミットの修正）

**提案形式**:
```markdown
### 追加すべき項目
- 注意点: gh pr create でラベル名はリポジトリに存在するものを正確に指定する（スペルミス注意）
```

---

## 提案すべきでないケース

### 1. 些細な変更

**提案しないケース**:
- 1回だけ使用したコマンド
- プロジェクト固有でない一般的なコマンド（`ls`, `cd` など）
- 一時的な実験やデバッグのための作業

**理由**: CLAUDE.mdが肥大化し、重要な情報が埋もれる

---

### 2. 既存内容と重複

**提案しないケース**:
- 既にCLAUDE.mdに記載されている内容
- 既存の記載と本質的に同じ内容（表現が異なるだけ）

**理由**: 重複により情報が混乱する

**確認方法**:
```
チェックリスト:
- [ ] CLAUDE.mdを全文読み込み済み
- [ ] 既存のセクションと照らし合わせ済み
- [ ] 重複がないことを確認済み
```

---

### 3. 新規情報がない場合

**提案しないケース**:
- セッション内で新しい発見や変更がない
- CLAUDE.mdに記載すべき新規情報がない

**出力**:
```markdown
## CLAUDE.md 更新提案

現在のセッションでは、CLAUDE.mdに追加すべき新規情報は見つかりませんでした。
既存のドキュメントは適切に機能しています。
```

---

## 分析観点の詳細

### 1. 新しいワークフロー

**分析ステップ**:
1. セッション内の作業パターンを抽出
   - タスク開始から完了までの一連の流れ
   - 繰り返し出現するパターン
2. CLAUDE.mdの既存ワークフローと比較
3. 新規性と再利用性を評価
4. 提案すべきか判断

**評価基準**:
- **新規性**: CLAUDE.mdに記載されていない
- **再利用性**: 今後も使う可能性が高い
- **汎用性**: 他のタスクにも適用可能
- **効率性**: 作業時間やエラーを削減する

---

### 2. 重要なコマンド

**分析ステップ**:
1. セッション内で使用された全コマンドをリストアップ
2. 使用頻度を集計（3回以上 = 重要）
3. 複雑度を評価（長い、覚えにくい、オプションが多い）
4. CLAUDE.mdの既存コマンドと比較

**評価基準**:
- **使用頻度**: 3回以上
- **複雑度**: 覚えにくい、引数が多い
- **プロジェクト固有性**: プロジェクト特有の設定や引数
- **新規性**: CLAUDE.mdに未記載

---

### 3. プロジェクト構造の変更

**分析ステップ**:
1. 新しく作成されたディレクトリやファイルを確認
   - `mkdir` コマンドの実行履歴
   - `Write` ツールでの新規ファイル作成
2. 用途を分析（一時的 vs 永続的）
3. CLAUDE.mdの既存構造記載と比較

**評価基準**:
- **永続性**: 一時的でなく、今後も使用される
- **標準性**: 標準的な保存先として機能する
- **重要性**: プロジェクトの理解に必要
- **新規性**: CLAUDE.mdに未記載

---

### 4. ベストプラクティス

**分析ステップ**:
1. セッション内の「良い習慣」を抽出
   - エラー削減に寄与した方法
   - 品質向上に寄与した方法
   - 効率化に寄与した方法
2. 汎用性を評価
3. CLAUDE.mdの既存ベストプラクティスと比較

**評価基準**:
- **効果**: 品質向上やエラー削減に寄与
- **汎用性**: 他のタスクにも適用可能
- **再現性**: 誰でも実践できる
- **新規性**: CLAUDE.mdに未記載

---

### 5. 注意点

**分析ステップ**:
1. セッション内のエラーや問題を抽出
2. 再発可能性を評価
3. 回避方法の明確性を確認
4. CLAUDE.mdの既存注意点と比較

**評価基準**:
- **再発可能性**: 今後も起こり得る
- **回避可能性**: 明確な回避方法がある
- **影響度**: エラーや問題の深刻度
- **新規性**: CLAUDE.mdに未記載

---

## 品質チェックリスト

### 提案生成前

```
事前確認チェックリスト:
- [ ] CLAUDE.mdを全文読み込み済み
- [ ] セッション内容を分析済み
- [ ] 新規情報の有無を確認済み
- [ ] 重複がないことを確認済み
```

### 提案生成後

```
品質チェックリスト:
- [ ] 追加すべき項目が具体的で明確
- [ ] 修正すべき項目が既存セクションと対応
- [ ] 削除すべき項目が古い情報として妥当
- [ ] 提案理由が簡潔で説得力がある
- [ ] ユーザーが理解しやすい形式
- [ ] 重要な変更のみに絞られている
```

### 出力形式チェック

```
形式チェックリスト:
- [ ] マークダウン形式で記述
- [ ] セクションが適切（追加/修正/削除/理由）
- [ ] 箇条書きが適切に使用されている
- [ ] 「なし」の場合も明記
- [ ] 提案理由が記載されている
```

---

## トラブルシューティング

### 問題: 提案が多すぎる

**原因**: 些細な変更まで提案している

**対策**:
- 使用頻度基準を厳格化（3回以上のみ）
- 「重要な変更のみ提案」の原則を再確認
- CLAUDE.mdへの影響度を評価（高いものだけ提案）

### 問題: 提案が抽象的

**原因**: 具体的な内容を分析していない

**対策**:
- 実際に使用したコマンドやファイルパスを含める
- 「〜について」ではなく「〜の使用方法」と具体化
- 例示を追加する

### 問題: 既存内容と重複

**原因**: CLAUDE.mdの確認不足

**対策**:
- CLAUDE.mdを必ず全文読み込む
- キーワード検索で類似記載を確認
- 既存セクションとの対応を明確化
