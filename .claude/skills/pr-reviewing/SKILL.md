---
name: pr-reviewing
description: PRレビューの専門スキル。5段階レビュープロセス（初期分析→詳細分析→ベストプラクティス参照→統合評価→品質検証）でコード品質・セキュリティ・パフォーマンスを評価。
allowed-tools: [Read, Grep, Glob, Bash, WebFetch]
---

# PR Reviewing

## 概要

このスキルは Pull Request の詳細なレビューを実施する。5段階のレビュープロセスで、コード品質、セキュリティ、パフォーマンス、テスト、設計を総合的に評価し、エビデンスベースのフィードバックを提供する。

## 主要機能

- 5段階レビュープロセスの実行
- レビュー観点別評価（品質/セキュリティ/パフォーマンス/テスト/設計）
- エビデンスベースのフィードバック（目標80%以上）
- 構造化されたレビュー結果の出力（`ai/reviews/`）

## 使用方法

### PR情報の取得

**PR番号の抽出ロジック**:
- `#123` 形式の場合: 123を抽出
- `https://github.com/owner/repo/pull/123` 形式の場合: owner, repo, 123を抽出
- 数字のみの場合: そのまま使用

**gh CLI呼び出し例**:
```bash
# PR詳細取得
gh pr view <PR番号>

# PR差分取得
gh pr diff <PR番号>

# PRファイル一覧取得
gh pr view <PR番号> --json files

# 特定のリポジトリのPR
gh pr view <PR番号> --repo owner/repo
```

### 5段階レビュープロセス

#### Phase 1: 初期分析
**目的**: PR情報と変更内容を把握

1. `gh pr view`でPR情報を取得
2. `gh pr diff`で差分を取得
3. `git log`でコミット履歴を確認
4. 変更ファイル一覧を確認

**完了条件**:
- ✅ 変更ファイル一覧取得済み
- ✅ コミット履歴取得済み

#### Phase 2: 詳細分析
**目的**: 変更の影響範囲と依存関係を理解

1. `Grep`/`Glob`で変更ファイルの構造を把握
2. `Read`ツールで変更ファイルを読み取り
3. `Grep`で依存関係を追跡
4. 影響範囲を特定

**完了条件**:
- ✅ 変更シンボルを分析
- ✅ 依存関係を特定
- ✅ 影響範囲を特定

#### Phase 3: ベストプラクティス参照
**目的**: 外部知識とプロジェクトルールを収集

1. 使用技術を特定（フレームワーク、ライブラリ）
2. `WebFetch`で公式ドキュメントを検索
3. ベストプラクティスを取得

**完了条件**:
- ✅ ベストプラクティス参照を取得

#### Phase 4: 統合評価
**目的**: 収集した情報を統合し、レビュー観点別に評価

1. Phase 1-3で収集した情報を統合
2. レビュー観点別に評価を実施
3. 各指摘にエビデンスを付与

**完了条件**:
- ✅ 全てのレビュー観点を評価
- ✅ 構造化されたレビュー結果を生成
- ✅ 指摘事項の80%以上にエビデンスを付与

#### Phase 5: 品質検証
**目的**: レビュー結果の品質を検証

1. 自己検証チェックリスト実行
2. レビュー結果を `ai/reviews/` に保存

**完了条件**:
- ✅ チェックリスト完了
- ✅ レビュー結果保存完了

## Examples

**例1: PR番号を指定してレビュー**
```
User: "PR #123をレビューして"
Assistant:
Phase 1: gh pr view 123 && gh pr diff 123
Phase 2: 変更ファイルをRead/Grepで分析
Phase 3: WebFetchでベストプラクティスを取得
Phase 4: 統合評価を実施
Phase 5: ai/reviews/に保存
```

**例2: PR URLを指定してレビュー**
```
User: "https://github.com/owner/repo/pull/456をレビューして"
Assistant:
1. URLからowner, repo, 456を抽出
2. gh pr view 456 --repo owner/repo
3. 5段階プロセスを実行
```

## Guidelines

### レビュー観点

#### 1. コード品質
- **命名規則**: 変数、関数、クラス名の一貫性
- **単一責任原則**: 関数/メソッドが単一の責任を持つか
- **DRY原則**: コードの重複が排除されているか
- **エラーハンドリング**: 適切な例外処理
- **コメント**: 複雑なロジックへの適切なコメント

#### 2. セキュリティ
- **入力検証**: ユーザー入力の適切な検証
- **機密情報**: ハードコードされた認証情報がないか
- **認証・認可**: 適切なチェックが実装されているか
- **脆弱性対策**: SQLインジェクション、XSS、CSRF等の対策

#### 3. パフォーマンス
- **アルゴリズム効率**: 適切な時間計算量
- **不要な処理**: 無駄なループや計算の排除
- **メモリ使用**: メモリリークや過剰使用がないか
- **N+1問題**: データベースクエリの最適化

#### 4. テスト
- **テストカバレッジ**: 変更に対する適切なテスト
- **エッジケース**: 境界値やエラーケースのテスト
- **テスト可読性**: テストコードの理解しやすさ

#### 5. 設計
- **既存パターン**: プロジェクトの既存パターンとの一貫性
- **拡張性**: 将来の変更への対応しやすさ
- **依存関係**: 適切な依存関係管理
- **インターフェース**: API設計の適切さ

### エビデンスベースのフィードバック

すべての指摘にはエビデンスを含める（目標: 80%以上）:
- **公式ドキュメントURL**: WebFetch検索結果
- **コード例**: 推奨される実装パターン
- **影響範囲**: Grep分析結果

**フィードバック形式**:
```markdown
**[ファイル名:行番号]** 指摘内容

**カテゴリ**: code_quality|security|performance|test|design
**重要度**: 高|中|低

**根拠**:
- [公式ドキュメントURL]
- [ベストプラクティス参照]

**影響範囲**（Grep分析結果）:
- 直接参照: X箇所
  - ファイル:行番号
  - ...

**推奨**: 改善提案

**コード例**:
\```language
// 推奨される実装
\```
```

### 出力フォーマット

```markdown
# PR Review: [タイトル]

## 概要
- 変更ファイル数: X
- 差分行数: X
- レビュータイプ: Standard/Deep Review
- PRタイプ: 機能追加/バグ修正/リファクタリング

## フェーズ実行結果
- ✅ Phase 1: 初期分析
- ✅ Phase 2: 詳細分析
- ✅ Phase 3: ベストプラクティス参照
- ✅ Phase 4: 統合評価
- ✅ Phase 5: 品質検証

## 評価サマリー
- コード品質: ⭐⭐⭐⭐☆
- セキュリティ: ⭐⭐⭐⭐⭐
- パフォーマンス: ⭐⭐⭐⭐☆
- テスト: ⭐⭐⭐☆☆
- 設計: ⭐⭐⭐⭐☆

## 詳細レビュー

### コード品質
[観点別の詳細評価]

### セキュリティ
[観点別の詳細評価]

### パフォーマンス
[観点別の詳細評価]

### テスト
[観点別の詳細評価]

### 設計
[観点別の詳細評価]

## 指摘事項

### 🔴 重要度: 高（必須対応）
[エビデンスベースの指摘]

### 🟡 重要度: 中（推奨対応）
[エビデンスベースの指摘]

### 🟢 重要度: 低（任意対応）
[エビデンスベースの指摘]

## ポジティブフィードバック
- ✅ [良かった点1]
- ✅ [良かった点2]

## 総評
[総合的な評価]

## 推奨アクション
- [ ] 重要度:高の項目を修正
- [ ] [その他推奨事項]
```

### 自己検証チェックリスト

レビュー出力前に必ず確認（目標: 全項目クリア）:

#### 1. 完全性チェック
- [ ] レビューの全観点がカバーされているか
- [ ] 5つのPhaseすべてが完了しているか
- [ ] 変更されたすべての重要ファイルがレビューされているか

#### 2. 具体性チェック
- [ ] すべての指摘に**ファイル名と行番号**が明記されているか
- [ ] 指摘内容が**具体的で実行可能**か（曖昧な表現を避ける）
- [ ] 改善提案に**コード例**が含まれているか（必須ではないが推奨）

#### 3. 建設性チェック
- [ ] 各指摘に**改善提案**が含まれているか

#### 4. エビデンスチェック（最重要）
- [ ] **エビデンス付与率が80%以上**か
- [ ] エビデンスの種類:
  - **公式ドキュメント**: WebFetch検索結果のURL
  - **コード例**: 推奨される実装パターン
  - **影響範囲分析**: Grep分析結果
- [ ] エビデンスが**実際に参照可能**か（URLが有効か）

#### 5. 優先度チェック
- [ ] 重要度（高/中/低）が**明確に示されている**か
- [ ] セキュリティ問題は**重要度:高**として明記されているか
- [ ] 軽微な問題は**重要度:低**として適切に分類されているか

#### 6. フォーマットチェック
- [ ] Markdown形式が正しいか
- [ ] コードブロックに言語指定があるか
- [ ] 絵文字（🔴🟡🟢✅）が適切に使用されているか

## Limitations

- コードの直接修正は行わない（レビュー結果の出力のみ）
- GitHub CLIが認証済みである必要がある（`gh auth status`で確認）
- プライベートリポジトリにアクセスするには適切な権限が必要
- WebFetchの利用可能性に依存（外部ドキュメント検索）

## Version History

- **1.0.0** (2025-12-20): 初版リリース（MCPツール参照を削除、gh CLIに移行）
